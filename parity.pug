introduction
    p.
        These are notes for Céline Maistret's course MA842 at BU Spring 2019.

    p.
        The course webpage is #[url(href="https://sites.google.com/view/cmaistret/teaching#h.p_BYGoPzU848FJ")/].
    aside: p Lecture 1 22/1/2018

    p
        | Outline
        ol
            li: p
                | Elliptic curves and their ranks
                ol
                    li: p
                        | Background
                        ol
                            li Mordell Weil theorem (state and prove) (ANT and cohomological proof)
                            li Non-effectivity
                            li Computing the rank (descent)
                    li: p
                        | The Birch and Swinnerton-Dyer conjecture
                        ol
                            li Heuristic via counting points omn the reduced curve
                            li #[m L]-functions
                            li BSD-1
                            li Local arithmetic invariants and BSD-2
                    li: p
                        | Parity of ranks
                        ol
                            li Isogeny invariants of BSD 2
                            li Galois representations and local root numbers
                            li The parity conjecture
            li: p
                | Abelian surfaces
                ol
                    li Background on genus 2 curves and their Jacobians
                    li BSD in this case
                    li Computability of local arithmetic invariants
                    li Parity conjecture

    p
        | Evaluation, none, when not around will give exercise/project, if you come regularly and do a computation you pass.
    p
        | Main references that we will be following:
        ol
            li Vladimir Dokchitser - Lecture course
            li Silverman - Arithmetic of Elliptic Curves
            li Milne - Abelian Varieties?

section#subsec-ec-ranks
    title Elliptic curves and their ranks

    introduction: p
        | Sources: Silverman I, V. Dokchitser's lectures.

    subsection#subsubsec-mordell-weil
        title Mordell-Weil


        p
            | Let #[m K] be a number field and let #[m E/K] be an elliptic curve.
            | The group #[m E(K)] is finitely generated.
            me E(K) \simeq E(K)_{\text{tors}} \oplus \ZZ^r
            | . Where #[m E(K)_{\text{tors}}] is a finite subgroup and #[m r] is the rank, a non-negative integer.
        p
            | Assuming that we can compute the torsion subgroup, computing the rank would completely determine #[m E(K)] and hence solve the associated diophantine problem.
        p
            | Plan
            ol
                li
                    | Understand the proof of Mordell-Weil
                li
                    | See where it is non-effective.
                li
                    | From the proof, extract a strategy to sometimes compute the rank (define Selmer groups, Shafarevich-Tate group).

        proof
            title Outline proof of Mordell-Weil
            p
                | Part 1: Prove that
                me E(K)/mE(K)
                | is finite for some #[m m \ge 2].
            p
                |Part 2: use a descent argument with heights of points.

        p
            | Of these two parts of the proof, part 1 is the challenging/interesting one.
        p
            | For part 2: Assuming that
            me E(K)/mE(K)
            | is finite and that #[m E] has a #[q height function] then #[m E(K)] is finitely generated.

        theorem#thm-parity-descent-gp
            title Descent theorem (see Thm. VIII 3.1)
            statement: p
                | Let #[m A] be an abelian group, suppose that there exists a function
                me h \colon A \to \RR
                | with the following properties:
                ol
                    li
                        | Let #[m Q \in A] then there is a constant  #[m c_1] depending on #[m Q] and #[m A] such that
                        me h(P+Q) = 2h(P) + c_1,\,\forall P \in A
                        |.
                    li
                        | There is an integer #[m m \ge 2] and a constant #[m c_2] depending on #[m A] s.t.
                        me h(mP) \ge m^2 h(P) - c_2,\,\forall P\in A
                        |.
                    li
                        | For every constant #[m c_3], the set
                        me \{P\in A : h(P) \le c_3\}
                        | is finite.
                | suppose further that for the #[m m] in #[m 2.] we have #[m A/mA] is finite.
                | Then #[m A] is finitely generated.
            proof
                p
                    | Choose elements #[m Q_1, \ldots, Q_r\in A] to represent the finitely many cosets in #[m A/mA].
                    | Let #[m P] be a point in #[m A].
                    | We show that #[m P] can be generated by #[m Q_1, \ldots, Q_r] plus a set of finitely many points of bounded height.
                p
                    | First write
                    me P = mP_1 + Q_{i_1}
                    | for some #[m 1 \le i \le r].
                    | Repeat this for
                    me P_1 = m P_2 + Q_{i_2}
                    me P_2 = m P_3 + Q_{i_3}
                    me \vdots
                    me P_{n-1} = m P_n + Q_{i_n}
                    | by property 2. of #[m h] we have
                    me h(P_j) \le \frac{1}{m^2} (h(m P_j) + c_2)
                    me \frac{1}{m^2} (h(P_{j-1}) - Q_{i_j}) + c_2)
                    me \le \frac{1}{m^2}(2 h(P_{j-1}) + c'_1 + c_2)
                    | by 1.
                    | Where #[m c'_1] is the maximum of the constants from #[m i] for #[m Q] in #[m \{-Q_1, \ldots, -Q_r\}].
                    | Note that #[m c_1'] and #[m c_2] do not depend on #[m P] and that #[m h(P) \ge0].
                    | We repeat this inequality starting from #[m P_n] and working back to #[m P].
                    me h(P_n) \le \left( \frac 2{m^2} \right)^n h(P) + \frac 1{m^2} \left(1+ \frac 2{m^2} + \left(\frac 2{m^2}\right)^2 + \cdots+ \left(\frac 2{m^2}\right)^{n-1}\right)(c_1' + c_2)
                    me =          \left( \frac 2{m^2} \right)^n h(P) + \frac 1{m^2} \left(1+ \frac 2{m^2} + \left(\frac 2{m^2}\right)^2 + \cdots+ \left(\frac 2{m^2}\right)^{n-1}\right)(c_1' + c_2)
                    me \lt        \left( \frac 2{m^2} \right)^n h(P) + \frac{c_1' + c_2}{m^2 - 2}
                    me \le        \frac 1{2^n} h(P) + \frac{c_1' + c_2}{2}
                    | , since #[m m \ge 2].
                    | Hence for #[m n]  sufficiently large (to make #[m \frac 1{2^n} h(P) \le 1]) we have
                    me h(P_n) \le 1 + \frac 12 (c_1' + c_2)
                    | .
                    | Since #[m  P] is a linear combination of #[m P_n] and #[m Q_i]
                    me P =  m^n  P_ n  + \sum_{j=1}^n m^{j-1} Q_{i_j}
                    | , it follows that every #[m P \in A] is a linear combination of points in
                    me \{Q_1, \ldots, Q_r\}\cup \{Q \in A : h(Q) \le 1 + \frac 12 (c_1' + c_2) \}
                    | .


        remark
            p
                | On #[m E/\QQ] the height function
                me h \colon E(\QQ) \to \QQ
                me.
                    P \mapsto \begin{cases}
                    \log(\max\{|p|,|q|\}),\,x(P) = \frac pq, \amp P\ne 0,\\
                    0, \amp P= 0.
                    \end{cases}
                | satisfies the conditions of #[xref(ref="thm-parity-descent-gp")/].

        remark
            p
                | The above proof is effective.
                | To find generators of #[m E(\QQ)] first compute #[m c_1 = c_1(Q_i)] for each #[m i], then compute #[m c_2].
                | Find points of bounded height.
                | Note that we need #[m Q_1,\ldots ,Q_r] to start with.
        p
            | It remains to show part 1:
        theorem
            title Weak Mordell-Weil
            statement: p
                | Let #[m K] be  a number field #[m E/K] an elliptic curve, #[m m \ge 2] then
                me \#E(K)/mE(K) \lt \infty
                | .

        p
            | We will prove this under the assumption that #[m E\lb m \rb \subseteq E(K)].
            | This is WLOG since:
        lemma
            statement: p
                | Let #[m L/K] be a finite Galois extension, if
                me E(L)/mE(L)
                | is finite then so is
                me E(K)/mE(K)
                | .
            proof
                p
                    me 0 \to \phi  \to E(K)/ m E(K) \xrightarrow{\varphi} E(L)/mE(L) \to 0
                    | induced by
                    me E(K) \subseteq E(L)
                    | , and prove that #[m \phi] is finite.
                    | Kernel #[m \phi] is given by
                    me \frac{E(K) \cap mE(L)}{mE(K)}
                    | , take #[m P \in \phi]. We can choose #[m Q_P \in E(L)] such that #[m Q_P = P].
                    | Define a map of sets
                    me \lambda_P \colon G_{L/K} \to E\lb m \rb
                    me \sigma \mapsto Q_P^\sigma - Q_P
                    | . Note that
                    me \lb m \rb (Q_P^\sigma - Q_P) = (\lb m \rb Q_P)^\sigma - \lb m \rb Q_P = 0
                    | .
                p
                    | Now we show that the association
                    me \phi \to \operatorname{Map}(G_{L/K}, E\lb m \rb)
                    me P \mapsto \lambda_P
                    | is 1 to 1.

                p
                    | Suppose that #[m P,P' \in E(K) \cap m E(L)] satisfying #[m \lambda_P = \lambda_{P'}] then
                    me (Q_P - Q_{P'})^\sigma = Q_P -  Q_{P'}
                    | for all #[m \sigma \in G_{L/K}] so #[m Q_P - Q_{P'} \in E(K)] and hence
                    me P - P' = \lb m \rb   Q_P - \lb m \rb Q_{P'} \in m E(K)
                    | hence
                    me P = P' \pmod {m E(K)}
                    | .
                    | #[m G_{L/K}] and  #[m E\lb m \rb] are both finite, hence so is #[m \phi].




        aside: p Lecture 2 29/1/2018

        p
            | Now we will prove the weak Mordell-Weil theorem.
            | Using the above lemma we can reduce to the case where #[m E\lb m \rb \subseteq E(K)], so we assume this going forwards.

        definition#def-kummer-pair
            title The Kummer pairing
            statement: p
                | The #[term Kummer pairing] is
                me \kappa \colon E(K) \times G_{\overline K/K} \to E\lb m \rb
                me P,\sigma \mapsto Q^\sigma - Q
                | where #[m Q] is a choice of point in #[m E(\overline K)] such that #[m mQ = P].

        proposition
            statement
                p
                    | #[m \kappa] is well defined, bilinear, the kernel in the first argument is #[m m E(K)] and in the second argument is #[m G_{\overline K/L}] where #[m L = K(\lb m \rb \inv E(K))] is the compositum of all fields #[m \kappa(x(Q), y(Q))] as #[m Q] ranges over all the points of #[m E(\overline K)] s.t. #[m m Q \in E(K)].

                p
                    | Hence the Kummer pairing induces a perfect bilinear pairing
                    me E(K)/ m E(K) \times G_{L/K} \to E\lb m \rb
                    | i.e. the map
                    me E(K) / m E(K) \to \Hom_{K}( G_{L/K} , E \lb m \rb )
                    me P \mapsto (\sigma \mapsto Q^{\sigma} - Q)
                    | is an isomorphism.

            proof
                p
                    | Of part 4.
                p
                    | Take

        aside: p Lecture 3 31/1/2018

        aside: p Lecture 4 5/2/2018

        remark
            p
                | A homomorphism #[m \phi \colon \absgal{K} \to G] for a finite group #[m G] is continuous if it comes from a finite Galois extension, i.e.
                me \exists F/K \text{ finite Galois },\,\tilde \phi \colon \Gal{F}{K} \to G
                | s.t. #[m \phi] is  the composition #[m \absgal{K} \to  \Gal FK \xrightarrow{\tilde \phi} G]. So #[m \phi(g) ] only cares about what #[m g] does to #[m F].

        proposition
            statement: p
                | Let #[m E/K] be an elliptic curve
                me y^2 = (x-\alpha)(x-\beta)(x-\gamma)
                | for #[m P \in E(K)] have #[m \frac 12 P \in E(\overline K)] s.t. #[m \frac 12 P \oplus \frac 12 P = P].
                ol
                    li
                        | #[m K(\frac 12 P) /K] is a Galois extension and #[m \Gal{K(\frac 12 P)}{K} = C_2 \times C_2] from Lemma 1.
                        // TODO
                    li
                        me \phi_P \colon \absgal{K} \to E(K)[2]
                        me g \mapsto Q^\sigma - Q  = g(\frac 12 P) - \frac 12 P
                        | is well defined and has kernel #[m \Gal{K}{K(\frac 12 P)}].
                    li
                        me \phi \colon E(K) / 2E(K) \to \Hom_{cts}(\absgal{K}, E(K)[2])
                        me P \mapsto \phi_P
                        | is well defined and injective.
                        | Now #[m \phi_P] is continuous by #[m 2.] and  so
                        me \phi_{P\oplus Q} (g) = g(\frac 12 (P\oplus Q)) - (\frac 12 P\oplus \frac 12 Q)
                        me = g(\frac 12 P) \oplus g(\frac 12Q) - \frac 12 P \ominus \frac 12 Q
                        me = \phi_P(g) \oplus \phi_Q(g)
                        | a homomorphism.
                        me \phi_{2Q}(g) = g(\frac 12 2 Q)) - \frac12 2(Q) = g(Q) - Q = 0
                        | for all #[m g\in \absgal K] if #[m Q \in E(K)] so  this is well defined.
                        | For injectivity:
                        me \phi_P(g) = 0 \implies g(\frac 12 P) = \frac 12 P \forall g \in \absgal K
                        me \implies \frac 12 P \in E(K) \implies P \in 2 E(K)
                        | which gives injectivity.
                    li
                        me \eta \colon \Hom_{cts}(\absgal K , E(K) [2] ) \to K^\times/{K^\times}^2 \times K^\times/{K^\times}^2 \times K^\times/{K^\times}^2
                        me \psi \mapsto\psi_\alpha ,\psi_\beta, \psi_\gamma
                        me \psi(g )\in \{0, (\alpha,0)\} \subseteq E(K) \iff g \in \Gal{\overline K }{K(\sqrt {\psi_\alpha})}
                        | then #[m \eta] is an injective homomorphism.
                        | It is an isomorphism to the subgroup of triples #[m a,b,c] s.t. #[m abc \in {K^\times}^2].
                        | Proof:
                        me \Hom_{cts}(\absgal K, C_2) \simeq K^\times/{K^\times}^2
                        | with #[m \psi] s.t. #[m \ker \psi = \Gal{\overline K}{ K\sqrt d}  \leftrightarrow d].
                        | It is an isomorphism:
                        me \ker \psi_i = \Gal{\overline K}{ K(\sqrt {d_i})},\,i =1,2
                        me \ker \psi_1 \psi_2 = \Gal{\overline K}{ K(\sqrt {d_1d_2})}
                        | Now apply this to #[m E(K) \lb 2\rb = C_2 \times C_2] to get an isomorphism to #[m K^\times / {K^\times}^2 \times K^\times / {K^\times}^2 ].
                        | Record this third homomorphism to get #[m \eta].
                    li
                        | If #[m P = (x_0, y_0) \in E(K)] then
                        me \eta(\phi_P)   = (x_0 - \alpha, x_0 - \beta, x_0 -\gamma)
                        | .
                        | Proof sketch:
                        | If
                        me E\colon y^2 = x^3 + Ax^2 + Bx
                        | then for #[m Q = (x_0, y_0) \in E(K)].
                        me 2Q = \left(\left( \frac {x_0 - B}{2y_0}\right)^2 , \ldots\right)
                        | Hence if #[m 2Q = P  = (x_1, y_1)] then  #[m \sqrt{x_1} \in K(\frac 12 P)].
                        | So if
                        me E \colon y^2 = (x-\alpha)(x-\beta)(x-\gamma)
                        | then
                        me P = (x_2, y_2)
                        | then
                        me \sqrt{x_2 - \alpha} , \sqrt{x_2 - \beta} , \sqrt{x_2 - \gamma} \in K(\frac  12 P)
                        me K(\sqrt{x_2 - \alpha}) , K(\sqrt{x_2 - \beta}) , K(\sqrt{x_2 - \gamma}) \subseteq K(\frac  12 P)
                        me \implies K(\frac 12 P)  = K(\sqrt{x_2 - \alpha},\sqrt{x_2 - \beta} , \sqrt{x_2 - \gamma})

        example
            statement
                p
                    | Let
                    me E \colon y^2 = x(x-1)(x+1)
                    | for #[m P \in E(\QQ), \QQ(\frac 12 P ) / \QQ] can only ramify at 2.
                    me \QQ(\frac 12 P ) \subseteq \QQ(i, \sqrt2)
                    me P = (x_0, y_0) \mapsto x_0, x_0 - 1, x_0 + 1 \in \QQ^\times/ {\QQ^\times}^2
                    | is a  homomorphism so #[m x_0 , x_0  -1 , x_0 + 1 ] are #[m \pm 1, \pm 2] up to square.


                table
                    caption Images
                    tabular(top="major",left="major",right="major",bottom="major")
                        | #[col(right="minor")/] #[col(right="minor")/] #[col(right="minor")/] #[col/]
                        row(bottom="minor") #[cell: m x_0] #[cell: m x_0 - 1] #[cell: m x_0 + 1] #[cell rat?]
                        row #[cell 1] #[cell 1] #[cell 1] #[cell 1) rat]
                        row #[cell 1] #[cell -1] #[cell -1] #[cell 2) non-rat]
                        row #[cell 1] #[cell 2] #[cell 2] #[cell 1) rat]
                        row #[cell 1] #[cell -2] #[cell -2] #[cell 2) non-rat]
                        row #[cell -1] #[cell 1] #[cell -1] #[cell 2) non-rat]
                        row #[cell -1] #[cell -1] #[cell 1] #[cell 1) rat]
                        row #[cell -1] #[cell 2] #[cell -1] #[cell 2) non-rat]
                        row #[cell -1] #[cell -2] #[cell 2] #[cell 1) rat]
                        row #[cell 2] #[cell 1] #[cell 2] #[cell 3) non-rat]
                        row #[cell 2] #[cell -1] #[cell -2] #[cell 2) non-rat]
                        row #[cell 2] #[cell 2] #[cell 1] #[cell 4) rat]
                        row #[cell 2] #[cell -2] #[cell -1] #[cell 2) non-rat]
                        row #[cell -2] #[cell 1] #[cell -2] #[cell ?]
                        row #[cell -2] #[cell -1] #[cell 2] #[cell ?]
                        row #[cell -2] #[cell 2] #[cell -1] #[cell ?]
                        row #[cell -2] #[cell -2] #[cell 1] #[cell ?]
                p
                    | 1) The 2-torsion points #[m P = 0 ,(0,0), (1,0), (-1,0) \in E(\QQ)] give us some rows.
                    | 2) As we have #[m x_0 \gt -1] we get #[m x_0 + 1 \gt 0] so #[m x_0(x_0 - 1) \gt 0] for the product to be a square (and hence #[m \gt 0]).
                    | 3) #[m x_0 = 2A^2], #[m x_0-1 = B^2], #[m x_0 + 1 = 2C^2] with #[m A,B,C \in \QQ \smallsetminus \{ 0\}].
                    | Let #[m A = m/n] so #[m 2m^2/ n^2 - 1 = B^2]
                    me 2m^2 - n^2 = (Bn)^2
                    |and
                    me 2m^2+ n^2 = 2(Cn)^2
                    | if #[m m \equiv 0(2) \implies -1 = \square \pmod 8] a contradiction.
                    me m \equiv 1 \pmod2 \implies m^2 \equiv1 \pmod 8
                    |.
                    | So #[m 2 - n^2 = \square \pmod 8 \implies n^2 \equiv1 \pmod 8]
                    me 2 + n^2 = 2\square \pmod 8 \implies n^2 \equiv 0 \pmod 8
                    me |E(\QQ) / 2 E(\QQ)| = 4
                    me | E(\QQ)[2]| = 4 \implies \rk = 0
                    me E(\QQ) \cong  E(\QQ) [2 ]
                    | .
                    | 4) Use the group structure!

        theorem
            title Complete 2-decent
            statement: p
                | Let #[m K] be a field of characteristic 0 and
                me E \colon y^2 = (x-\alpha)(x-\beta)(x-\gamma),\,\alpha,\beta,\gamma \text{ distinct}
                |. The map
                me P \mapsto (x_0 - \alpha, x_0 - \beta, x_0 - \gamma)
                | replacing #[m x_0 -\alpha] with  #[m (x_0 - \beta) (x_0 - \gamma)] if 0.
                me E(K) / 2E(K) \to (K^\times/ {K^\times}^2) ^3
                | Triples #[m (a,b,c)] that lie in the image satisfy #[m abc \in {K^\times}^2].
                | A triple #[m a,b,c] with #[m abc \in {K^\times}^2] lies in the image iff
                | it is in the image of #[m E(K)\lb 2\rb] or
                me cz_3^2 - \alpha + \gamma = az_1^2
                me cz_3^2 - \beta + \gamma = bz_1^2
                | is soluble with #[m z_i \in K^\times].
                | In which case
                me P = (az_1^2 + \alpha, \sqrt{abc}, z_1z_2z_3) \mapsto (a,b,c)
                | iii) If #[m K] is a number field and #[m (a,b,c)] is in the image then
                me K(\sqrt{a}, \sqrt{b}, \sqrt{c}) / K
                | only ramifies at primes dividing #[m 2(\alpha - \beta)(\alpha - \gamma)(\beta - \gamma)].
        exercise
            statement: p
                me E \colon y^2 = x(x-5)(x+5)
                | .

        aside: p Lecture 5 7/2/2018

        p
            | Recall:
            me \phi \colon E(K)/2E(K) \to \Hom_{cts}(G_K, E(K) [2])
            me P \mapsto \phi_P
            | where #[m \phi_P \colon \sigma \mapsto Q^\sigma - Q] where #[m Q = 2P].
            | Which is well-defined and injective.
        p
            | Elements of
            me \Hom_{cts}(G_K, E[2]) \leftrightarrow a,b,c \in (K^\times / {K^\times}^2) \text{ s.t. } abc \in {K^\times}^2
            me (x_0,y_0) \mapsto (x_0 - \alpha, x_0 - \beta, x_0  -\gamma)
            | .
        lemma
            statement: p
                | Let #[m n \ge 1]
                ol
                    li
                        me \psi \colon E(K)/ nE(K) \to \{ K \subseteq F \subseteq \overline K\}
                        me P\mapsto K(\frac 1n P, E[n])

                        | is well defined.
                    li
                        | #[m K(\frac 1n P, E\lb n \rb ) / K] only ramifies at #[m \ideal p | n \Delta_E].
                    li
                        me \Gal{K(\frac 1n P, E [n] )}{K} \le \ZZ/n \times \ZZ/n
                    li
                        | There are only finitely many fields satisfying 2. and 3. so #[m \image \psi] is finite.

        p
            | To do descent, need more than #[m \psi] (i.e. injection).

        definition
            statement: p
                | Let #[m G] be a group and  #[m M] a #[m G]-module then let
                me H^0(G, M) = M^G = \{m \in M : gm = m \forall g\in G\}
                me H^1(G, M) = \{\text{skew homs } G \to M\}/\{\text{skew homs } G \to M \text{ of the form }g\mapsto g(t) - t,\, t\in M\}
                | .

        remark
            p
                | If #[m G] acts trivially on #[m M] then
                me H^0(G, M) = M
                me H^1(G, M) = \Hom(G,M)
                | .
            p
                | When #[m G] is profinite then we want that the skew homomorphisms factor through finite Galois  groups.
                | We will prove that
                me E(K)/nE(K) \hookrightarrow H^1(G_K, E[n])
                | .

        theorem
            statement: p
                | If
                me 0 \to A \to B \to C \to 0
                | is an exact sequence of #[m G]-modules then
                me 0 \to H^0(G,A)\to H^0(G,B)\to H^0(G,C)\to H^1(G,A)\to H^1(G,B)\to H^1(G,C)
                | .

        lemma
            statement: p
                ol
                    li
                        | #[m \psi] is finite-to-one (gives Mordell-Weil)
                    li
                        | Let
                        me \phi_P \colon G_K \to E[n]
                        me \phi_P (gh) = \phi_P(g) + g \phi_P(h)
                        | is a skew (or crossed) homomorphism.
                        | If #[m (\frac 1n P ) '] is another choice of #[m \frac 1n P] and #[m \phi_P'] is the corresponding skew homomorphism, then
                        me \phi_P - \phi_P '
                        | is of the form
                        me g\mapsto T \ominus gT
                        | where #[m T \in  E\lb n\rb].
                    li
                        | #[m \phi_P] factors through
                        me \Gal{K(\frac 1n P, E\lb n \rb)}{K}
                        |.
                    li
                        me \phi\colon E(K) / nE(K) \to Z/B
                        me P \mapsto \phi_P
                        | is an injective homomorphism.
                        | Where
                        me Z = \{\text{skew homs } G_K \to E[n]\}
                        me B = \{\text{skew homs } G_K \to E[n] \text{ of the form }g\mapsto T\ominus gT,\,T\in E\lb n\rb\}
                        |.
        proof
            p
                ol
                    li
                        | There are finitely many skew homomorphisms
                        me \Gal{K(\frac 1nP, E[n])}{K} \to E[n]
                        | and by 4.
                        me P \mapsto \{\phi_P, K(\frac 1n P, E\lb n \rb)\}
                        | is injective.
                        | So #[m \psi\colon P\mapsto K(\frac 1n P, E\lb n \rb)] is finite to one by 3.
                    li
                        me \phi_P(gh) = \frac 1n P \ominus gh \frac 1n P
                        me = \left((\frac 1n P) \ominus g(\frac 1n P)\right) \oplus \left( g(\frac 1n P) \ominus g(h(\frac 1n P))\right)
                        me = \phi_P \oplus g(\phi_P(h))
                        | .
                        | Remark: If #[m E\lb n \rb \subseteq E(K)] then #[m \phi_P] is a homomorphism.
                        | Recall for #[m n=2]
                        me \phi_P(gh) = \frac 12 P \ominus gh(\frac 12 P)
                        me  = \frac12 P \ominus h(\frac 12P) \oplus h(\frac 12 P) \ominus g(h( \frac 12 P))
                        me = \phi_P(h) \oplus \phi_P(g)
                        | since #[m 2h(\frac 12 P) = h(P)= P].
                        | Consider now
                        me \frac 1n P = \frac 1n P'  \oplus T
                        | for some #[m T\in E\lb n \rb]
                        me (\phi_P \ominus \phi_{P}')(g) = \phi_P(g)  - \phi_{P}'(g) =  \frac 1n P \ominus g(\frac 1n P) - [(\frac 1n P ) \oplus T \ominus g(\frac 1n P) \oplus gT]
                        me =T \ominus gT
                        | .

        p
            | Take #[m G= G_K]
            me B = E(\overline K), A= E[n], C = E(\overline K)
            | to get
            me 0 \to E[n] \to E(\overline K) \xrightarrow{\cdot n} E(\overline K) \to 0
            | which gives the long exact sequence
            me 0 \to E(K)[n] \to E(K) \xrightarrow{\cdot n} E(K) \xrightarrow{\delta} H^1(G_K, E[n]) \to H^1(G_K, E(\overline K)) \to
            me \implies E(K)/nE(K) \hookrightarrow H^1(G_K, E[n])
            | .
        p
            | Problem:
            me H^1(G_K, E[n])
            | is infinite.
            | What subgroup of
            me H^1(G_K, E[n])
            | do we land in?


        p
            | Notation:
            | When #[m v] is a place of #[m K] we have #[m G_{K_v} \subseteq G_K], for any module #[m M] have #[m M^{G_K} \le M^{G_{K_v}}] and
            me \Res \colon H^1(G_K, E[n]) \to H^1 (G_{K_v} , E[n])
            | .
        p
            | We have from the theorem
            me.
                \xymatrix{
                0 \ar[r] &amp; E(K)/ nE(K)\ar[d] \ar[r]^\delta &amp; H^1(G_K, E[n]) \ar[d]^{\Res} \ar[r] &amp; H^1(G_K, E(\overline K))[n] \ar[d]^{\Res}\ar[r]&amp;0\\
                0 \ar[r] &amp; \prod_v E(K_v)/ nE(K_v) \ar[r]^\delta &amp; \prod_v H^1(G_{K_v}, E[n]) \ar[r] &amp; \prod_v H^1(G_{K_v}, E(\overline K))[n] \ar[r]&amp;0
                }
            | we want to understand #[m \image \delta] i.e. the subgroup
            me \ker \{ H^1(G_K, E[n]) \to H^1 (G_K, E(\overline K))\}
            | this is as hard as finding #[m E(K)], here is why:
        claim
            statement: p
                me H^1(G_K, E(\overline K))
                | corresponding to principal homogeneous spaces for #[m E] (genus 1 curves whose jacobian is #[m E])
        p
            | Finding
            me \ker \{ H^1(G_K, E[n]) \to H^1 (G_K, E(\overline K))\}
            | is equivalent to finding which PHS coming from #[m H^1] have a rational point.
            | ??? Hensel's lemma.

        p
            | Let #[m C] be a curve
            me \operatorname{Isom}(C) \leftrightarrow C(\overline K) \times \Aut(C)
            me \tau_p \circ \alpha \leftrightarrow (P,\sigma)
            me \operatorname{Twist}(E/K) \leftrightarrow H^1(G_K, \operatorname{Isom}(C))
            me C\simeq_{\overline K} E
            me PHS \leftrightarrow H^1(G_K, E(\overline K))
            | #[m C] is a PHS for #[m E] iff #[m E] is the jacobian of #[m C].

        aside: p Lecture 6 14/2/2018
        p
            me.
                \xymatrix{
                0 \ar[r] &amp; E(K)/ nE(K)\ar[d] \ar[r]^\delta &amp; H^1(G_K, E[n]) \ar[d]^{\Res} \ar[r] &amp; H^1(G_K, E(\overline K))[n] \ar[d]^{\Res}\ar[r]&amp;0\\
                0 \ar[r] &amp; \prod_v E(K_v)/ nE(K_v) \ar[r]^\delta &amp; \prod_v H^1(G_{K_v}, E[n]) \ar[r] &amp; \prod_v H^1(G_{K_v}, E(\overline K))[n] \ar[r]&amp;0
                }
        definition#def-twist-curve
            title Twists of curves
            statement: p
                | A #[term twist] of #[m C/K] is a smooth curve #[m C'/K] that is isomorphic to #[m C] over #[m \overline K].

        p
            | If #[m C_1, C_2] are twists of #[m C/K] and #[m C_1\simeq_K C_2] then we say that #[m C_1] and #[m C_2] are equivalent modulo #[m K]-isomorphism.

        p
            | We denote #[m \operatorname{Twist}(C/K)] - the set of twists of #[m C/K] modulo #[m K]-isomorphism.
        theorem
            statement: p
                | The twists of #[m C/K] up to #[m K]-isomorphism are in 1-1 correspondence with elements of
                me H^1(G_K, \operatorname{Isom}(C))
                | where
                me \operatorname{Isom}(C) = \{\overline K\text{-isomorphisms } C\to C\}
                | .
            proof
                p
                    | Let #[m C'/K] be a twist of #[m C/K] then there exists an isomorphism #[m /\overline K]
                    me \phi\colon C' \to C
                    | associate the following map
                    me \xi \colon G_K \to \operatorname{Isom}(C)
                    me \sigma\mapsto \phi^\sigma \phi\inv
                    | .
                p
                    | Check that #[m \xi] is a cocycle
                    me \xi_{\sigma\tau } = (\xi_{\sigma})^\tau \xi_\tau
                    | for all #[m \sigma,\tau\in G_K].
                    | Denote #[m \{\xi\}] the associated class in #[m H^1].
                    | #[m \{\xi\}] is determined by the #[m K]-isomorphism class of #[m C'] independent of the choice #[m \phi].
                p
                    | The map
                    me \operatorname{Twist}(C/K) \leftrightarrow H^1(G_K, \operatorname{Isom}(C))
                    me C' \mapsto \{\xi\}
                    | is a bijection.
                p
                    | Injective, trace through.
                p
                    | Surjectivity, define the function field using the curve.
        remark: p
            | If #[m C] is an elliptic curve then #[m \operatorname{Isom}(C)] is generated by
            me \Aut(C) (\text{fixing }0)
            | and translations
            me \tau_P \colon C \to C
            me Q\mapsto Q+P
            |.

        example
            statement: p
                | #[m E/K] elliptic, consider
                me K(\sqrt d)
                | a quadratic extension and #[m \chi] the associated character
                me \chi\colon G_K \to \{\pm 1\}
                me \sigma \mapsto \sigma(\sqrt d) / \sqrt d
                | .
                | The group #[m \pm 1] can be viewed as automorphisms of #[m C].
                | So use #[m \chi] to define the cocycle
                me \xi \colon G_K \to \operatorname{Isom}(C)
                me \sigma \mapsto [\chi (\sigma)]
                | .
                | Let  #[m C/K] be the corresponding twist of #[m E/K], we find an equation for #[m C/K].
                | Choose
                me y^2 = f(x) \text{ for } E/K
                | and write
                me \overline K(E) = \overline K(x,y)
                me \overline K(C) = \overline K(x,y)_\xi
                | since #[m \lb - 1 \rb(x,y) = (x,-y)] the action of #[m \sigma \in G_K] on
                me \overline K(x,y)_\xi \text{ is given by }\sqrt d ^\sigma = \chi(\sigma) \sqrt d
                me x ^\sigma = x,\,y = \chi(\sigma) y
                | note that the function #[m x' = x] and #[m y' = y /\sqrt d] are in #[m \overline K(x,y)_\xi] and are fixed by #[m G_K].
                | Now #[m x',y'] satisfy
                me d{y'}^2  =f(x')/K
                | is defined over #[m K] and defines an elliptic curve.
                | Moreover
                me (x,y) \mapsto (x', y' \sqrt{d})
                | is an isomorphism over #[m K(\sqrt d)].


        p
            | Note #[m C/K] is not a principal homogeneous space for #[m E/K].

        definition#def-homog-space
            title Homogenous spaces
            statement: p
                | Let #[m E/K] be an elliptic curve, a principal homogeneous space for #[m E/K] is a smooth curve #[m C/K] together with a simply transitive algebraic group action of #[m E] on #[m C] defined over #[m K].
                me \mu \colon C\times E \to C
                | morphism defined over #[m K] satisfying
                ol
                    li
                        me \mu(P, 0) = P \,\forall P \in C
                    li
                        me \mu(\mu(p,P), Q) = \mu(p,P+Q) \,\forall P \in C
                    li
                        me \forall p,q \in C,\,\exists ! P\in E \text{ s.t. }
                        me \mu(p,P) = q
                        | so we may define a subtraction map
                        me \nu \colon C\times C \to E
                        me p,q \mapsto P
                        | as above.

        proposition
            statement: p
                | Let #[m E/K] and #[m C/K] be a principal homogeneous space for #[m E/K].
                | Fix a point #[m p_0 \in C] and define a map
                me \theta \colon E \to C
                me P \mapsto \underbrace{p_0 + P}_{\mu(p_0, P)}
                | .
                ol
                    li
                        | #[m \theta] is an isomorphism over #[m K(p_0)].
                        | In particular  #[m C/K] is a twist of #[m E/K].
                    li
                        | #[m \forall p,q \in C]
                        me q- p = \theta\inv(q) - \theta \inv (p)
                        | .
                    li
                        | #[m \theta] is a morphism over #[m K].

        definition
            statement: p
                | Two homogeneous space #[m C/K] and #[m C'/K] for #[m E/K] are equivalent if there is an isomorphism
                me \phi \colon C \to C'
                | defined over #[m K] and is compatible with the action of #[m E] on #[m C] and #[m C'].
                me.
                    \xymatrix{
                    C \ar[r]^\theta \ar[d]_\phi &amp; E \ar[d] \\
                    C' \ar[r] &amp; E'
                    }

        p
            | The equivalence class of PHS for #[m E/K] containing #[m E/K] acting on itself via translation is called the trivial class.

        p
            | The collection of equivalence classes of PHS for #[m E/K] is called the Weil-Châtelet group, denoted
            me WC(E/K)
            | .

        proposition
            statement: p
                | Let #[m C/K] be a PHS for #[m E/K] then #[m C/K] is in the trivial class #[m \iff  C(K) \ne \emptyset].

        theorem
            statement: p
                | Let #[m E/K] then there is a natural bijection after fixing #[m p_0 \in C]
                me WC(E/K) \to H^1 ( G_K, \underbrace{E(\overline K)}_{\subseteq \operatorname{Isom}(E)})
                me \{C/K\} \mapsto \{ \sigma \mapsto p_0^\sigma -  p_0\}

            proof
                p
                    | Well-definedness:
                    me \sigma \mapsto p_0^\sigma - p_0
                    | is a cocycle.
                    | Suppose that #[m C'/K] and #[m C/K] are two equivalent PHS then
                    me p_0^\sigma - p_0
                    | and
                    me {p_0'}^\sigma - p_0'
                    | are cohomologous.
                p
                    |Injective, suppose that #[m p_0^\sigma - p_0] and #[m {p_0'} ^\sigma - p_0'] corresponding to #[m C/K] and #[m C'/K] that are cohomologous and prove that #[m C\simeq_K C'].
                p
                    | Surjective: let #[m \xi \colon G_K \to E(\overline K)] be a cocycle representing an element in #[m H^1(G_K, E)].
                    | Embed
                    me E(\overline K) \hookrightarrow \operatorname{Isom}(E)
                    me P \mapsto \tau_P
                    | and view
                    me \xi \in H^1(G_K, \operatorname{Isom} E)
                    |.
                p
                    | From the theorem on
                    me \operatorname{Twist}(E/K) \leftrightarrow H^1(G_K, \operatorname{Isom}(E))
                    | there exists a curve #[m C/K] and a #[m \overline K]-isomorphism
                    me \phi\colon C \to E
                    | s.t.
                    me \forall \sigma \in G_K : \phi^\sigma \phi\inv = \text{translation by } -\xi_\sigma
                    | .
                    | Define a map #[m \mu \colon C\times E \to C]
                    me (p,Q) \mapsto \phi\inv (\phi(p) + Q)
                    | .
                p
                    | Show that #[m \mu] is simply transitive.
                p
                    | Show #[m \mu] defined over #[m K].
                    | Compute the cohomology class associated to #[m C/K] and show it is #[m \xi].

        remark: p
            | For a given #[m C/K] of genus 1 one can define several structures of PHS.
            me \{C/K,\mu\}^\alpha = \{ C/K , \mu\circ(1\times \alpha)\}
            me \mu^\alpha(p,Q) = \mu(p, \alpha Q)
            | for #[m \alpha \in \Aut(E)].
            me.
                \xymatrix{
                C \ar[r]^\mu &amp; E \ar[d]_P \\
                C' \ar[r]^{\mu^\alpha} &amp; E'
                }

        aside: p Lecture 7 21/2/2018

        example
            statement: p
                | #[m E/K] and #[m K (\sqrt d)/K] a quadratic extension.
                | Let #[m T \in E(K)] be a non-trivial point of order 2.
                | Then #[m \xi\colon G_K \to E]
                me.
                    \sigma \mapsto
                    \begin{cases}
                    0 \amp\text{ if } (\sqrt d)^\sigma = \sqrt d,\\
                    T \amp\text{ if } (\sqrt d)^\sigma = -\sqrt d.
                    \end{cases}
                |.
                | We construct the PHS corresponding to #[m \{\xi \} \in H^1(G_K, E(\overline K))].
                | Since #[m T \in E(K)] can choose a Weierstraß equation for #[m E/K]
                me E\colon y^2 = x^3 + ax^2 + bx \text{ with } T = (0,0)
                | then the translation by #[m T] map is given by
                me \tau_T(P) = (x,y) + (0,0) = \left(\frac bx, -\frac{by}{x^2}\right)
                | for
                me P = (x,y)
                | .
                | Thus if #[m \sigma \in G_K] is non-trivial, #[m \sigma] acts on #[m \overline K(E)_\xi], which is isomorphic to #[m \overline K(E)] but #[m \absgal K] action is twisted by #[m \xi], i.e. #[m x^\id \mapsto (x^\id)^\sigma].
                me (\sqrt d )^\sigma = -\sqrt d
                me x^\sigma = \frac bx ,\, y^\sigma = -\frac{by}{x^2}
                | need to find the subfield of  #[m K(\sqrt d)(x,y)_\xi] fixed by #[m \sigma].
                | Note:
                me \frac{\sqrt d x}{y},\,\sqrt d \left(x  -\frac bx\right)
                | are invariant, take
                me z = \frac{\sqrt d x }{y},\,w = \sqrt d\left( x - \frac bx\right)\left(\frac xy\right)^2
                | and find relations between #[m z] and #[m w] to get
                me C \colon dw^2 = d^2 - 2a dz^2 + (a^2 - 4b) z^4
                | .
                | Claim: #[m C/K] is the PHS of #[m E/K] corresponding to #[m \left\{\xi\right\}].
                | There is a natural map
                me \phi \colon E \to C
                me (x,y) \mapsto (z,w)
                me (x,y) \mapsto \left( \frac{ \sqrt d y}{x^2 + ax + b}, \frac{\sqrt d (x^2 - b)}{x^2 + ax + b}\right)
                | so that
                me \phi (0,0) = (0,-\sqrt d)
                me \phi (0) = (0,\sqrt d)
                ul
                    li
                        | Prove that #[m \phi ] is an isomorphism so #[m C] is a twist.
                    li
                        | #[m C] is the PHS corresponding to #[m \{\xi\}].
                        | Take #[m p \in C ] and compute
                        me \sigma\mapsto p^\sigma - p = \phi\inv(p^\sigma) - \phi\inv (p)
                        | for example let #[m p = (0,\sqrt d) \in C], if #[m \sigma = \id] then #[m p^\sigma - p = 0 - 0 = 0].
                        | If #[m \sigma = -\id] then #[m p^\sigma - p = T - 0 = T].


        p
            | Back to Selmer, we want to have the image of our weak Mordell-Weil land in something finite.
            me.
                \xymatrix{
                0 \ar[r] &amp; E(K)/ mE(K)\ar[d] \ar[r]^\delta &amp; H^1(G_K, E[m]) \ar[d]^{\Res} \ar[r] &amp; WC(E/K)[m] \ar[d]^{\Res}\ar[r]&amp;0 \\
                0 \ar[r] &amp; \prod_v E(K_v)/ nE(K_v) \ar[r]^\delta &amp; \prod_v H^1(G_{K_v}, E[n]) \ar[r] &amp; \prod_v WC (E/ K_v)[m]               \ar[r]&amp;0
                }

        definition#def-m-selmer
            title #[m m]-Selmer groups
            statement: p
                | The #[m m]-Selmer group of #[m E/K] is the subgroup of
                me H^1(G_K, E[m])
                | defined by
                me \Sel^m(E/K) = \ker \left\{H^1(G_K, E[m]) \to \prod_v WC(E/K_v) \right\}
                | .

        definition#def-sha
            title The Shafarevich-Tate group
            statement: p
                | The #[term Shafarevich-Tate] group of #[m E/K] is the subgroup of
                me WC(E/K)
                | defined by
                me \Sha(E/K) = \ker\left\{WC(E/K) \to\prod_v WC(E/K_v)\right\}
                | .

        theorem
            statement: p
                | There is an exact sequence
                ol
                    li
                        me 0 \to E(K)/mE(K) \to \Sel^m(E/K)  \to \Sha(E/K)[m] \to 0
                    li
                        | #[m \Sel^m(E/K)] is finite.

    subsection#subsec-p-inf-selmer
        title #[m p^\infty]-Selmer and the structure of #[m \Sha]

        p
            | #[m H^1(G_K, E(\overline K))] is torsion for general galois cohomological reasons.
            | So
            me \Sha (E/K) \subseteq H^1(G_K, E(\overline K))
            | is torsion.
        p
            | So we may write
            me \Sha(E/K) = \bigoplus_p \Sha_{p^\infty}(E/K)
            | where for each prime #[m p]
            me \Sha_{p^\infty} (E/K)
            | denotes the #[m p]-primary part of #[m \Sha(E/K)].
            | (i.e. the subgroup of elements whose order is a power of #[m p].)
            | By descent
            me \Sha (E/K) [ m] \text{ is finite for all } m \ge 1
            | .
        p
            | So
            me \Sha_{p^\infty} (E/K) \cong (\QQ_p/\ZZ_p)^{\delta_p} \oplus T_p,\, \delta_p \in \ZZ_{\ge 0}
            | where #[m T_p] is a finite abelian #[m p]-group.
            me T_p \cong \ZZ/p^{s_1} \ZZ \oplus \cdots \oplus \ZZ/p^{s_l} \ZZ,\,s_i\in \ZZ_{\ge 0}
            | .
            | The group
            me \bigoplus_p (\QQ_p/\ZZ_p)^{\delta_p}\subseteq \Sha (E/K)
            | is called the infinitely divisible subgroup of #[m \Sha] denoted #[m \Sha_{div}].
        p
            | The conjecture that #[m \Sha] is finite implies #[m \delta_p = 0] for all #[m p].
            | And #[m T_p \ne 0 ] for only finitely many #[m p].
        p
            | There is a pairing called the Cassels-Tate pairing
            me \Sha(E/K) \times \Sha(E/K) \to \QQ/\ZZ
            | which is bilinear and alternating, and the kernel on either side is the infinitely divisible group.
            | If #[m \Sha(E/K)] is finite then the pairing is non-degenerate and hence
            me |\Sha(E/K)| = \square    \in \ZZ
            | .

        definition#def-p-inf-selmer
            title #[m p^\infty]-Selmer group
            statement: p
                | Consider #[m \Sel_{p^n}(E/K)] and take the direct limit
                me \varinjlim_n \Sel_{p^n}(E/K)
                | to define the #[m p^\infty]-Selmer group.

        p
            | One shows that
            me X_p(E/K) = \Hom_{\ZZ_p} (\varinjlim_n \Sel_{p^n}(E/K), \QQ_p/\ZZ_p)
            | called the Pontyragin dual of the #[m p^\infty] Selmer group is a finitely generated #[m \ZZ_p]-module.
            | The associated #[m \QQ_p]-vector space, denoted #[m \mathcal X_p(E/K) =X_p(E/K) \otimes_{\ZZ_p} \QQ_p] has dimension #[m \rk_p].

        definition#def-p-inf
            statement: p
                | #[m \rk_p] is called the #[m p^\infty]-Selmer rank of #[m E/K] and satisfies
                me \rk_p = \rk(E/K) + \delta_p
                | .
        p
            | So if #[m \Sha] is finite then #[m \delta_p =0] for all #[m p].
            | Use BSD to compute parity of #[m \rk_p].

        aside: p Lecture ? 19/3/2018

    subsection
        title Consequences of BSD
        p
            | Consider #[m E/\QQ]:
            | Mordell-Weil implies that
            me E(\QQ) \simeq \ZZ^{\rk} \oplus \text{torsion}
            | then BSD 1 says that
            me \underbrace{\ord_{s=1} L(E,s)}_{\rk_\an} = \rk
            | , functional equation for #[m L(E,s)].

        p
            me L^*(E,s) =  w L^*(E, 2-s)
            | with #[m w\in \{\pm 1\}] the sign of the functional equation.
            | If #[m w = 1] then #[m L(E,s)] is (essentially) symmetric at #[m s=1].
            | So #[m \ord_{s=1} L(E,s)] is even.
            | If #[m w = -1] then #[m \ord_{s=1} L(E,s)] is odd.
        p
            | We get BSD mod 2:
            me (-1)^{\rk} = w(\text{sign of f.e.})
            | a conjecture based on conjecture is bad so we go one step further.
        theorem
            statement
                p
                    | The sign in the functional equation of #[m L(E,s)] is equal to the global root number of #[m E].
                p
                    | This is defined by
                    me w_\infty \prod_p w_p
                    | , the local root numbers defined in terms of the local galois representations.
                    | Non-trivial to understand, but manageable.

        conjecture
            title Parity conjecture
            statement: p
                me (-1)^{\rk} = \prod_v w_v = w
                | .

        example
            statement: p
                me E/\QQ \colon y^2 + y =     x^3 + x^2 - 7x + 5
                me \Delta_E = -7 \cdot 13
                | #[m w_v = 1] if #[m v\nmid \infty 7 \cdot 13]
                me w_\infty = -1
                | (in general #[m -1^{g}] where #[m g] is dimension of the abelian variety).
                me w_7 = -1
                me w_{13} = -1
                | so #[m w= -1] and the rank is odd, hence there is a point of infinite order on this curve.

        paragraphs
            title Problem

            p
                | On the one hand #[m \prod_v w_v] is computable.
                | On the other hand #[m (-1)^{\rk}] is precisely unknown.
                me (-1)^{\rk} = \prod _v w_v
                |.

        theorem
            statement: p
                | Assume #[m \Sha] is finite, let #[m \phi \colon E \to E'] be an isogeny whose degree is   not divisible by #[m \characteristic(K)], then
                me \frac{| \Sha_E| \Reg_E \prod_p c_p \Omega_E}{|E_{\tors}|^2} = \frac{| \Sha_{E'}| \Reg_{E'} \prod_p c'_p \Omega_{E'}}{|E'_{\tors}|^2}
                | .
        remark
            p
                | In fact this is true for all abelian varieties over #[m K].

        example
            statement
                p
                    | Let
                    me E/\QQ \colon y^2 + xy = x^3 - x
                    | #[url(href="http://www.lmfdb.org/EllipticCurve/Q/65/a/1")/].
                    | #[m \Delta_E =  5\cdot 13], it has a 2-isogenous curve #[m E'].
                p
                    | Compute
                    me c_5 = c_{13} = 1
                    me c'_5 = c'_{13} = 2
                    me \Omega_{E}  = 2\Omega_{E'}
                    | then
                    me \frac{\Reg_{E'}}{\Reg_E} = \frac{|\Sha_E| |E'_\tors|^2 \prod_p c_p \Omega_E}{|\Sha_{E'}| |E_\tors|^2 \prod_p c'_p \Omega_{E'}} \equiv \square \frac 24 \not \equiv 1 \square
                    | .

                p
                    | So #[m \Reg_E \ne 1], #[m \Reg_{E'} \ne 1] so #[m E] has at least one rational point of infinite order, so #[m \rk \ge 1].
        lemma
            statement
                p
                    | Assume #[m \Sha] is finite, let
                    me \phi\colon E/K \to E'/K
                    | be a #[m K]-rational isogeny of degree #[m d].
                p
                    | Write #[m n =  \rk_E = \rk_{E'}].
                    | Pick a basis #[m \Lambda =  \langle P_1, \ldots, P_n\rangle] for
                    me E(K) / \tors
                    | write #[m \Lambda'] for a basis of #[m E'(K)/\tors].
                    | Write #[m \phi^\vee  \colon E' \to E] for the dual isogeny s.t. #[m  \phi\phi^\vee = \lb d\rb].
                p
                    | using the following fact
                    me \pair{\phi(P)}{Q}_{E'} =  \pair{P}{ \phi^\vee(Q)}_E
                    | Then
                    me d^n \Reg_E = \det(\pair{dP_i}{P_j}_E )_{i,j}
                    me = \det(\pair{\phi^\vee\phi P_i}{P_j}_E) = \det(\pair{\phi P_i}{\phi P_j}_{E'})
                    me  = \Reg_{E'} \lb \Lambda' : \phi(\Lambda)\rb^2
                    | .

        // Dok NOTES ON THE PARITY CONJECTURE lem 1.3

        p
            | Back to the example
            me \frac{\Reg_E}{\Reg_{E'}} \equiv  \frac 12 \square
            | so by the lemma #[m \rk] is odd.
            | Here we assumed that #[m \Sha] is finite for elliptic curves, one can drop the assumption of finiteness of #[m \Sha] to get unconditional results on the parity of #[m \rk_p] for all #[m p].

        conjecture
            title #[m p]-parity
            statement: p
                me (-1)^{\rk_p} = w
                | .

        p
            | This is known over #[m \QQ] and totally real fields.


        p
            | How to compute the parity of #[m \rk_p(E/K)]?
            | Need BSD-invariance for Selmer groups.
            | (Details T. and V. Dokchitser #[q On the BSD quotients modulo squares],
            | and  Milne #[q Arithmetic duality theorems])

        definition
            statement: p
                | For an isogeny
                me \Psi\colon A \to B
                | of abelian varieties over #[m K].
                | Let
                me Q(\Psi) = | \coker(\Psi \colon A(K)/ A(K)_{\tors} \to B(K)/B(K)_{\tors})| \cdot | \ker(\psi \colon \Sha(A)_\divisible \to \Sha(B)_\divisible)|
                | .

        p
            | Recall #[m \rk_p = \rk + \delta_p] where
            me \Sha = \bigoplus \Sha_{p^\infty}
            | and
            me  \Sha_{p^\infty} \simeq (\QQ_p/ \ZZ_p)^\delta_p \oplus T_p
            me \Sha_{\divisible} = \bigoplus (\QQ_p / \ZZ_p)^{\delta_p}
            | .

        p

            | Strategy, we show that for #[m \Psi] an isogeny s.t. #[m \Psi \Psi^\vee = \lb p \rb].
            | Then
            me p^{\rk_p(E/K)} \equiv \frac{Q(\Psi^\vee)}{Q(\Psi)} \equiv \frac{\prod_v c_p}{\prod_v c'_v} \frac{\Omega_E}{\Omega_{E'}} \pmod {{K^\times}^2}
            | .


        remark
            p
                | Let #[m A^\vee] be the dual of #[m A]. #[m A^\vee = \Pic^0(A)].

        p
            | So
            me (-1)^{\rk_p(E/K)} =  (-1)^{\ord_p \left(\frac{\prod_v c_v \Omega_E}{\prod_v c'_v \Omega_{E'}}\right)}
            | the parity of #[m \rk_p(E/K)] is computable from local invariants of #[m E] and #[m E'].
        p
            |To prove the #[m p]-parity conjecture it remains to prove
            me (-1)^{\ord_p \left(\frac{\prod_v c_v \Omega_E}{\prod_v c'_v \Omega_{E'}}\right)} = \prod_v w_v
            | .

        aside: p Lecture ? 21/3/2018

        paragraphs
            title Aside: Generalisation of the definition of #[m \Sel^n(E/\QQ)]

            p
                | Consider
                me \Psi \colon A \to B
                | an isogeny of abelian varieties.
                | We have
                me  0 \to A(K)[\Psi] \to A(K) \xrightarrow \Psi B(K) \xrightarrow \delta H^1(G_K, A[\Psi]) \to H^1(G_K, A) \xrightarrow \Psi H^1(G_K, B)
                | from which we extract
                me 0 \to B(K)/ \Psi(A(K)) \xrightarrow \delta H^1(G_K, A[\Psi]) \to H^1(G_K, A)[\Psi] \to 0
                me 0 \to \prod_v B(K_v)/ \Psi(A(K_v)) \xrightarrow \delta H^1(G_{K_v}, A[\Psi]) \to \prod_v H^1(G_K, A)[\Psi] \to 0
                | we then define
                me \Sel^{(\Psi)} (A/K) = \ker \left\{ H^1(G_K, A[\Psi]) \to \prod_v H^1(G_{K_v}, A) \right\}
                me \Sha(A/K)= \ker\left\{ H^1(G_K, A) \to \prod_v H^1(G_{K_v}, A)\right\}
                | so
                me 0 \to \underbrace{B(K)/ \Psi(A(K))}_{\coker(\Psi \colon A(K) \xrightarrow \Psi B(K))} \to  \Sel^{(\Psi)} (A/K) \to \Sha(A/K) \to 0
                |.

        p
            | We want to show:
        theorem
            statement: p
                | Let #[m E/K] be an elliptic curve, #[m K] a  number field, if #[m \Psi ] is s.t. #[m \Psi \Psi^\vee = \lb p \rb]  then
                me p^{\rk_p(E/K)} \equiv \frac{Q(\Psi)}{Q(\Psi^\vee)} \equiv \frac{\prod_v c_p}{\prod_v c'_v} \frac{\Omega_E}{\Omega_{E'}} \pmod {{K^\times}^2}

        p
            | We will show this in 3 parts, first the left, then the right, then the equality with the global root number.

        paragraphs
            title Step 1

            proposition
                statement: p
                    me p^{\rk_p(E/K)} \equiv \frac{Q(\Psi)}{Q(\Psi^\vee)} \pmod {{K^\times}^2}
                proof
                    p
                        | Note that
                        me Q(\Psi \circ \Psi^\vee) = Q(\Psi) Q(\Psi^\vee)
                        | hence
                        me \frac{Q(\Psi)}{Q(\Psi^\vee)} \equiv \underbrace{Q(\Psi) Q(\Psi^\vee)}_{=Q([p])} \pmod{{K^\times}^2}
                        | now
                        me | \coker( [p] \colon E(K)/ E(K)_\tors \to E'(K) / E'(K)_\tors ) | = p^{\rk(E/K)}
                    p
                        | Proof of this:
                        | For each generator #[m R] of #[m E(K)/E(K)_\tors] then
                        me \frac1p R, \frac 2p R , \ldots, \frac{p-1}{p} R, R
                        | are not in the image of #[m \lb p\rb] which implies  the size is #[m p^{\rk(E/K)}].
                        | Also
                        me | \ker([p] \colon \Sha(E/K)_\divisible \to \Sha(E'/K)_\divisible)| = p^{\delta_p}
                        | since
                        me \Sha(E/K)_\divisible = \bigoplus_p (\QQ_p/\ZZ_p)^{\delta_p}
                        | and since #[m \lb p \rb] is trivial on all
                        me (\QQ_l/\QQ_l)^{\delta_l},\, l\ne p
                        | then look at #[m \lb p \rb \colon (\QQ_p/\ZZ_p)^{\delta_p} \to (\QQ_p/\ZZ_p)^{\delta_p}]
                        | if #[m x\in \QQ_p/\ZZ_p] and #[m \ker \lb p \rb] then #[m p x\in \ZZ_p \implies  x = a/p] for #[m a\in \FF_p].

                        | so
                        me p^{\delta_p}
                        | .

        paragraphs
            title Step 2

            p
                | We show that
                me \frac{Q(\Psi)}{Q(\Psi^\vee)} \equiv \frac{\prod_v c_p}{\prod_v c'_v} \frac{\Omega_E}{\Omega_{E'}} \pmod {{K^\times}^2}
                |.

            theorem
                statement
                    p
                        | Let #[m A,B / K ] be abelian varieties given with a non-zero global exterior form #[m \omega_A, \omega_B].
                        | Suppose
                        me \Psi \colon A \to B
                        | is an isogeny and
                        me \Psi^\vee \colon B^\vee \to A^\vee
                        | its dual.
                    p
                        | Let  #[m \Sha_0(A/K)] denote #[m \Sha(A/K)] mod its divisible part.
                        | And
                        me \Omega_A = \prod_{v | \infty,\text{ real}} \int_{A(K_v)} |\omega_A| \prod_{v|\infty,\text{ complex}} 2^{\dim A} \int_{A(K_v)} \omega_A \wedge \overline{\omega_A}
                        | .
                        | Then
                        me \frac{Q(\Psi^\vee)}{Q(\Psi)} = \frac{|B(K)_\tors||B^\vee(K)_\tors|}{|A(K)_\tors||A^\vee(K)_\tors|} \frac{\prod_v c_p(A/K)}{\prod_v c_v(B/K)} \frac{\Omega_A}{\Omega_{B}} \prod_{p|\deg \Psi} \frac{| \Sha_0(A) [p^\infty]|}{| \Sha_0(B) [p^\infty]|}
                        |.


            remark
                p
                    | If #[m A  = E], #[m B =E'] with #[m \Psi] s.t. #[m \Psi \Psi^\vee = \lb p \rb ] then
                    me E\simeq E^\vee,\, E'\simeq {E'}^\vee
                    | and #[m |\Sha_0| = \square].
                    me \frac{Q(\Psi^\vee)}{Q(\Psi)} \equiv \frac{\prod_v c_p}{\prod_v c'_v} \frac{\Omega_E}{\Omega_{E'}}\pmod {{K^\times}^2}
                    | .

            proof
                title Sketch proof of theorem
                p
                    | We show how to obtain the quotient of Tamagawa numbers, for a sufficiently large set of places #[m S] of #[m K]
                    me \frac{Q(\Psi^\vee)}{Q(\Psi)} \frac{| \Sha [\Psi^\vee]|}{| \Sha [\Psi]|} = \prod_{v\in S} \frac{|\ker \Psi_v|}{|\ker \Psi^\vee_v|}
                    | where  #[m \Psi_v] is the induced map on #[m E(K_v) \to E' (K_v)].
                    | If #[m v\nmid \infty] and #[m v\in S] what is
                    me \frac{|\ker \Psi_v|}{|\coker \Psi_v|}?
                    me.
                        \xymatrix{
                                 &amp;     &amp;   0 \ar[d]            &amp;      &amp;   \\
                                 &amp;  0\ar[d]  &amp;   \ker \Psi_v  \ar[d] &amp; H_1\ar[d]  &amp;   \\

                        0 \ar[r] &amp; E_1(K_v) \ar[r]\ar[d]  &amp;E(K_V) \ar[r]\ar[d]  &amp;E(K_v)/E_1(K_v) \ar[r]\ar[d] &amp; 0 \\
                        0 \ar[r] &amp; E'_1(K_v) \ar[r]\ar[d] &amp; E'(K_V)\ar[d] \ar[r]&amp; E'(K_v)/E'_1(K_v) \ar[r]\ar[d] &amp;  0\\
                              &amp;  0  &amp;   \coker \Psi_v  &amp; H_2  &amp;
                        }
                p
                    | Snake lemma gives
                    me 0 \to \ker \Psi_v \to H_1 \to 0 \to \coker \Psi_v \to H_2 \to 0
                    me \implies |\ker \Psi_v  | = |H_1|
                    | and
                    me |\coker \Psi_v| = |H_2|
                    | .
                    | Also
                    me \left | \frac{E(K_v)/E_1(K_v)}{H_1}\right| =  \left | \frac{E'(K_v)/E'_1(K_v)}{H_2}\right|
                    |.
                p
                    | Moreover since #[m E, E'] are isogenous we have
                    me | \widetilde E_\ns (\overline k) |=| \widetilde E'_\ns (\overline k) |
                    | hence since
                    me 0 \to E_1(K_v) \to E_0 (K_v) \to  \widetilde E_\ns (\overline k) \to 0
                    | similarly for #[m E'].
                    | We have
                    me | E_0(K_v) / E_1(K_v) |  = | E'_0(K_v) / E'_1(K_v) |
                    me \implies \left | \frac{E'(K_v) / E_1'(K_v)}{E(K_v) / E_1(K_v)} \right| = \left | \frac{E'(K_v) / E_0'(K_v)}{E(K_v) / E_0(K_v)} \right| = \frac{c_v}{c'_v}
                    | .


            p
                | Hence
                me (-1)^{\rk_p(E/K)} = (-1)^{\ord_p\left( \prod_v \left| \frac{\coker \Psi_v}{\ker \Psi_v}\right|\right)}
                me                   = (-1)^{\ord_p\left( \frac{\prod_v c'_v}{\prod_v c_v} \underbrace{\prod_{v|\infty} \left| \frac{\coker \Psi_v}{\ker \Psi_v}\right|}_{\Omega_E/\Omega_{E'}} \right) }
                |.

        paragraphs
            title Step 3

            p
                | We need to show that
                me (-1)^{\rk_p(E/K)}=  w_E \text{ (p-parity)}
                | i.e. we need to show that
                me (-1)^{\ord_p\left( \frac{\prod_v c'_v}{\prod_v c_v}\frac{\Omega_E}{\Omega_{E'}} \right)} = w_E
            p
                | Strategy:
                me (-1)^{\ord_p\left( \frac{\prod_v c'_v}{\prod_v c_v}\frac{\Omega_E}{\Omega_{E'}} \right)} = \prod_{v \nmid \infty} (-1)^{\ord_p \frac{c'_v}{c_v}} \prod_{v |\infty} (-1)^{\ord_p \left | \frac {\ker \Psi_v}{\coker \Psi_v} \right | }
                | and relate
                me (-1)^{\ord_p \frac{c'_v}{c_v}}
                | to #[m w_v] for #[m v\nmid \infty] and
                me (-1)^{\ord_p \left | \frac {\ker \Psi_v}{\coker \Psi_v} \right |}
                | to #[m w_v] for #[m v\mid \infty].
            p
                | Then take product over all places.

        aside: p Lecture ? 26/3/2018

        p
            | Let #[m E/ K ] be an elliptic curve admitting an isogeny #[m \Psi] of degree #[m p] (defined over #[m K]).
            | Recall that we proved
            me  p^{\rk_p(E/K)} =  \prod_v \frac{c_v}{c_v'} \frac{\Omega_E}{\Omega_{E'}}
            | #[m v] missing #[m p]. More precisely
            me p^{\rk_p(E/K)} \equiv \prod_{v|p\infty} \frac{c_v}{c'_{v}} \prod_{v|\infty} \left| \frac{\ker \psi_v}{\coker \psi_v}\right|
            | where #[m \psi_v] is the map induced by #[m \psi] on #[m E(K_v)].
        p
            | What about #[m v | p] to extract
            me \frac{c_v}{c'_v}
            | from
            me \left| \frac{\ker \psi_v}{\coker \psi_v}\right|
            | at finite places we can use a diagram involving
            me 0 \to E_1(K_v) \to E'_1(K_v) \to \coker \to 0
            | .

        p
            | If #[m v\nmid p ] then #[m | \coker | = 1] since then on the level of the formal group #[m \psi] induces a map
            me \hat \psi \colon \hat E(\ideal m_K) \to \hat E'(\ideal m_K)
            me T \mapsto aT + \cdots

            | power series rep of #[m \psi] #[m \psi(x,y) = (x', y')] Silverman IV cor 4.3/
            | #[m \omega' \circ \psi = \psi' \circ \omega].
            | with leading #[m a = \psi^* \omega'/ \omega \times ] unit #[m \in \ints_K].
            me \implies aa'  = p \in \ints_K^\times  \implies \hat \psi\text{ isom}
            |.
        p
            | If #[m v | p] then #[m \coker] contributes to the snake lemma and at that place
            me \frac{c_v}{c'_v} \left| \frac{\psi^* \omega'}{\omega}\right|_v = \frac{c_E}{c_E'} \left| \frac{\omega}{\omega_v^0} \right|_v
            | for a particular choice of #[m \omega].

        paragraphs
            title Proving #[m p]-parity
            p
                | To prove the #[m p]-parity conjecture
                me (-1)^{\rk_p(E/K)} = w_E
                | .
            p
                | We will show that
                me (-1)^{\ord_p \prod_v \frac{c_v}{c'_v} \frac{\Omega}{\Omega_{E'}}} = w_E
                | by relating
                me (-1)^{\ord_p \frac{c_v}{c'_v}}
                | and #[m w_v] at some place #[m v\nmid p\infty]
                me (-1)^{\ord_p \frac{\Omega_E}{\Omega_{E'} }}= (-1)^{\ord_p \left| \frac {\ker \psi_v}{\coker \psi_v}\right| }
                | and #[m w_v] at #[m v | \infty].
            p
                | We only sketch these steps for #[m v\nmid p] and #[m E ] is semistable at #[m v].
            p
                | The proofs of #[m p]-parity for #[m p] odd and #[m p= 2] are different.
        paragraphs
            title #[m p] odd
            p
                | The #[m p]-parity conjecture is proven for principally polarized abelian varieties with  a #[m  p]-cyclic isogeny with #[m p \ge 2g +2 ] or #[m p \ge 2] and semistable reduction and some local constraints at #[m v|p].
                | see Root numbers selmer groups and non-commutative Iwasawa theory, Coates, Fukaya, Kato, Sujatha
            p
                | Sketch, for an elliptic curve with a #[m p]-isogeny #[m \psi]
                | we look at #[m v|\infty] where #[m w_v = -1],
                | and
                me (-1)^{\ord_p \left | \frac{\ker \psi_v}{\coker \psi_v}\right |}
                | if #[m v] is complex #[m |\ker \psi_v| = p] #[m |\coker \psi_v | = 1].
                | so
                me (-1)^{\ord_p \left | \frac{\ker \psi_v}{\coker \psi_v}\right |} = -1 = w_v
                |.
            p
                | If #[m v|\infty] is real what does #[m E(\RR)] look like?
                | Either there is a real period and so two real components, and all real #[m p]-torsion (if any) is on the identity component.
                | Or there is no real period and only 1 real component that contains all real #[m p]-tors if any.
                ol
                    li
                        | #[m |\ker \psi_v | = p] (the #[m p]-tors in #[m \ker \psi] are real)
                    li
                        | #[m |\ker \psi_v | = 1] (the #[m p]-tors in #[m \ker \psi] are not real)
            figure
                caption/
                image: latex-image.
                    \begin{tikzpicture}
                      \begin{axis}[hide axis]
                        \addplot +[no markers,
                          raw gnuplot,
                          thick,
                          empty line = jump, % not strictly necessary, as this is the default behaviour in the development version of PGFPlots
                          id = g13realroot,
                          ] gnuplot {
                          set contour base;
                          set cntrparam levels discrete 0.003;
                          unset surface;
                          set view map;
                          set samples 700;
                          set isosamples 500;
                          splot y^2 - x^3 + x;
                        };
                      \end{axis}
                    \end{tikzpicture}
            p
                | Moreover #[m |\coker \psi | = 1] always,
                | #[m \sgn(\Delta_E) = \sgn(\Delta_{E'})]

            p
                | More generally if #[m \deg \Psi] is odd then
                me E'(\RR)/ \psi(E(\RR)) \hookrightarrow H^1(\Gal{\CC}{\RR}, E[\psi]) = 0
                | since #[m \lb \CC:\RR\rb = 2 ] is coprime to #[m E\lb \psi\rb] (see Atiyah's book).

            p
                | In the first case
                me (-1)^{\ord_p \left | \frac{\ker \psi_v}{\coker \psi_v}\right |} = -1 = w_v
                | In the second case
                me (-1)^{\ord_p \left | \frac{\ker \psi_v}{\coker \psi_v}\right |} = 1 \ne w_v

            p
                | For #[m K] a local field let #[m F = K(\ker \psi_v)] noting that
                me \Gal{F}K \hookrightarrow (\ZZ/p\ZZ)^\times
                | from its action on points in #[m \ker \psi = F/K] is cyclic.
            p
                | Consider the composition
                me F^\times \xrightarrow{\text{local rec.}} \Gal F K \hookrightarrow(\ZZ/p)^\times
                |.
                | and denote
                me (-1, F/K)
                | the image of #[m -1] under the above map.
                me (-1, F/K) = \begin{cases} 1 \amp \text{ if } -1 \text{ is a norm from }F\text{ to }K,\\ - 1\amp\text{otw}\end{cases}
                | this is the Artin symbol.

            p
                | This is perfect as they cancel out globally.
            p
                | If #[m v] is complex then #[m F = \CC], #[m K = \CC] and #[m (-1, F/K) = 1]
            p
                | If #[m v] is real and #[m |\ker \psi_v| = p] then #[m F = \RR], #[m K = \RR] and #[m (-1, F/K) = 1]
            p
                | If #[m v] is real and #[m |\ker \psi_v| = 1] then #[m F = \RR], #[m K = \RR] and #[m (-1, F/K) = -1]

        paragraphs
            title #[m p =2]

            p
                |  Note that #[m (-1, F/K) =  1] for all places of #[m K] since if #[m E] admits a 2-isogeny #[m \psi/K] then is admits a 2-torsion point over #[m K].
            p
                | Hence #[m F = K(\ker \psi_v) = K]

            p
                | set -up
                me E/K
                | with a 2-isogeny #[m \psi/K]
                me E \colon y^2 = x(x+ax+ b)
                | by translating 2-torsion to (0,0)
                me \psi\colon E \to E':y^2= x(x^2 - 2ax + \delta)
                | where #[m \delta = a^2 - 4b =  \disc(x^2 + ax + b)]
                | if #[m \delta \gt 0 ] then #[m E(\RR) ] has two connected components.
                | #[m \delta \lt 0] only 1.

                | Have #[m 16b  = \disc(x^2 - 2ax +\delta)] likewise for #[m E']
            p
                me.
                        \xymatrix{
                                 &amp;     &amp;   0 \ar[d]            &amp;      &amp;   \\
                                &amp; \ker \psi_v^0  \ar[d]  &amp;   \ker \psi_v  \ar[d] &amp; \ker \psi_/\ar[d]  &amp;   \\

                            0 \ar[r] &amp; E^0(\RR) \ar[r]\ar[d]  &amp;E(\RR) \ar[r]\ar[d]  &amp;E(\RR)/E^0(\RR) \ar[r]\ar[d] &amp; 0 \\
                            0 \ar[r] &amp; E'^0(\RR) \ar[r]\ar[d] &amp; E'(\RR)\ar[d] \ar[r]&amp; E'(\RR)/E'^0(\RR) \ar[r]\ar[d] &amp;  0\\
                                  &amp;  \coker \psi_v^0  &amp;   \coker \psi_v  &amp; \coker \psi_/  &amp;
                            }

            p
                | by snakey
                me \frac{ | \ker \psi_v^0 || \ker \psi_/ || \coker \psi_v|}{|\ker \psi_v || \coker \psi_v^0|| \coker \psi_/| } = 1
                me \implies \left| \frac{\coker \psi_v}{\ker \psi_v}\right| = \frac{| \coker \psi^0_v|| \coker \psi_/|}{|\ker \psi_v^0|| \ker\psi_/|}
                | let #[m n(E), n(E')] be the number of real connected components #[m n = E(\RR) / E^0(\RR)]
            p
                | By the third column
                me \frac{n(E')}{n(E)} \frac{|\ker \psi_/|}{|\coker \psi_/|}  =1

                | now #[m | \coker \psi_v^0| = 1] as the map on identity component is surjective.
                | hence
                me \left | \frac {\coker \psi_v}{\ker \psi_v}\right|= \frac{n(E')}{n(E) | \ker \psi_v^0|}

            aside: p Lecture ? 28/3/2018

            p
                | Recall: to prove the #[m 2]-parity conjecture for #[m E/K]
                me (-1)^{\rk_2(E)} = w


                |???????????????????? missed


            p
                | Notation
                me E \colon y^2 = x(x^2+  ax+ b) = xq_1(x)
                me E' \colon y^2 = x(x^2-2 ax+ \delta) = xq_2(x),\,\delta = a^2 - 4b
                | #[m \disc(q_1(x)) = \delta]
                | #[m \disc(q_2(x)) = 16b]
            //figure TODO this one is pointless rn
                caption/
                image: latex-image.
                    \begin{tikzpicture}
                      \begin{axis}[hide axis]
                        \addplot +[no markers,
                          raw gnuplot,
                          thick,
                          empty line = jump, % not strictly necessary, as this is the default behaviour in the development version of PGFPlots
                          id = g1nonsymm,
                          ] gnuplot {
                          set contour base;
                          set cntrparam levels discrete 0.003;
                          unset surface;
                          set view map;
                          set samples 700;
                          set isosamples 500;
                          splot y^2 + y - x^3 + x^2;
                        };
                      \end{axis}
                    \end{tikzpicture}

            p
                | a) If #[m \delta \gt 0], #[m b \gt 0] then
                | #[m E,E'] both have two real components, #[m n(E) = n(E') =2].
                me.
                    | \ker \psi_v^0| =
                    \begin{cases}
                    1 \amp \text{ if } (0,0)\text{ is not on } E^0(\RR)\\
                    2 \amp \text{ if } (0,0)\text{ is on } E^0(\RR)\\
                    \end{cases}=
                    \begin{cases}
                    1 \amp \text{ if } a \lt 0\\
                    2 \amp \text{ if } a \gt 0\\
                    \end{cases}

                | write #[m q_1(x) = x^2 + ax + b = (x-\alpha)(x-\beta)]
                | then  if #[m (0,0) \in E^0(\RR)], #[m \alpha,\beta\lt 0]
                | but #[m a = -\alpha -\beta] hence in this case #[m a \gt 0].
                me.
                    (-1)^{\ord_2 \left| \frac{\ker \psi_v}{\coker \psi_v } \right|}
                    =
                    \begin{cases}
                    1 \amp \text{ if } a \lt 0\\
                    -1 \amp \text{ if } a \gt 0\\
                    \end{cases}
                | so we need some correction if #[m  \delta \gt 0, b \gt 0, a \lt 0].

            p
                | b) If #[m \delta \gt 0, b \lt 0]
                | #[m E] has two real components and #[m E'] only 1 #[m n(E) = 2,n(E') = 1].
                me |\ker \psi_v^0 | = 1
                | since #[m b \lt 0] and #[m b = \alpha\beta].
                me (-1)^{\ord_2 \left| \frac {\ker \psi_v}{\coker \psi_v}\right|} = -1
                | so no correction if #[m \delta \gt 0, b \lt 0].
            p
                | c) If #[m \delta \lt 0,b \gt 0], #[m n(E) = 1], #[m n(E') =2].
                me |\ker \psi_v^0| = 2
                | and
                me (-1)^{\ord_2 \left| \frac {\ker \psi_v}{\coker \psi_v}\right|} = 1
                | need correction if #[m \delta \lt 0 , b \gt 0].
            p
                | d) #[m b \lt 0, \delta \lt 0] contradiction, #[m \delta = a^2 - 4b].

            p
                | So in summary if #[m \delta \gt 0, b \gt 0, a \lt 0] or  #[m \delta \lt 0, b \gt 0] need a correction,
                | if #[m \delta \gt 0, b \gt 0, a \gt 0] or  #[m \delta \gt 0, b \lt 0] no correction.
                me (-1)^{\ord_2 \left| \frac {\ker \psi_v}{\coker \psi_v}\right|}   =   ? w_v
                | First guess
                me (a, -b)(-a, \delta)
            p
                | Recall: let #[m K] be a local field
                me K^\times \times K^\times \to \{ \pm 1\}
                me.
                    (a,b) \mapsto
                    \begin{cases}
                    1\amp\text{ if } a \text{ is a norm from } K(\sqrt b ) \to K,\\
                    -1\amp\text{ otw}
                    \end{cases}
            p
                | If #[m K] is archimidean #[m (a,b) = -1 \iff a \lt 0,b \lt 0].
                | If #[m K] is non-archimidean with odd residue characteristic then
                me (\text{unit},\text{unit}) = 1
                me (\text{unit},\pi^n) =  -1
                | if #[m n] odd and unit is not a square.
                me (a,bc) = (a,b)(a,c)
                |.

            p
                | So guess
                me (a, -b)(-a, \delta)
                | works over #[m \RR].

            p
                | #[m v\nmid 2 \infty] need to show that
                me (-1)^{\ord_2 \frac{c_v}{c'_v}} = (a,-b)(-a, \delta) w_v
                | if #[m E] has good reduction at #[m v].
                me c_v = c'_v = 1
                | .
            p
                | Need to show that
                me (a, -b)(-a,\delta) = 1
                | .
            p
                | Since #[m E,E'] have good reduction at #[m v].
                | then #[m b,\delta] are units in #[m K].
                | If #[m a \in \ints_K^\times] then #[m (a,-b) (-a,b)  = 1]
                | if #[m a \equiv  0 \pmod {\pi_K}] then since #[m a^2 -  4b = \delta] then #[m \delta \equiv -4b \pmod{\pi_K}].
            p
                | If #[m E] has split multiplicative reduction, (multiplicative reduction is when #[m y^2 = f(x)] and #[m f(x)] has a double root mod #[m \pi_K], any two distinct tangents at the node, both defined over #[m k] (fixed by frob)).
                | so #[m E'] also has split multiplicative reduction as #[m \psi] commutes with frobenius.

            p
                | Need to compute
                me \frac{c_v}{c'_v}
                | by Tates algorithm
                me c_E = v(\Delta_E) = n
                | we show that
                me.
                    c_{E'} = v(\Delta_{E'}) =
                    \begin{cases}
                    2n,\\
                    \frac12n
                    \end{cases}

            p
                | Recall
                me E\colon y^2 = \overbrace{x(x^2 + ax + b)}^{f_E(x)} = x(x-\alpha)(x-\beta) = xq_1(x)
                me \Delta_{f_E} = \alpha^2 \beta^2 ( \alpha- \beta)^2 = b^2 (\alpha - \beta)^2 =  b^2 \delta
                me {E'}\colon y^2 = \overbrace{x(x^2 -2ax + \delta)}^{f_{E'}(x)} = x(x-A)(x-B) = xq_2(x)
                me \Delta_{f_{E'}} = A^2 B^2 ( A- B)^2 = \delta^2 (A - A)^2 =  \delta^2 16b
            p
                | if #[m v(\delta) = n] then #[m v(\Delta_{f_{E}}) = n] so #[m c_E = -n]
                | and #[m v(\Delta_{f_{E'}}) = 2n] so #[m c_{E'} = 2n]
                | in general if #[m E] admits a #[m p]-isogeny and #[m E] has split multiplicative reduction then
                me \frac{c_E}{c_{E'}} = p^{\pm 1}
                |.

            p
                | here #[m w_v = -1] and
                me (-1)^{\ord_2 \frac{c_E}{c_{E'}}} = -1
                | need to show that
                me (a,-b) (-a, \delta) = 1
                | if #[m E] has a double root at #[m (0,0)] wlog #[m \alpha  \equiv 0 \pmod \pi_K]
                | then #[m v(\delta) = 0], #[m v(b) \gt 0 ] and both slopes of tangent at #[m (0,0)] are defined over #[m k].
            p
                | Taylor expansion at #[m (0,0)]
                me f(x,y) = y^2 - x^3 - ax^2 - bx
                me = (y - s_1x)(y- s_2x) + h.o.t.
                me = y^2 - xy(s_1 + s_2) + s_1s_2 x^2 + h.o.t.

                | so #[m s_1 = -s_2] and #[m s_1 s_2 = -a] implies #[m s_1^2 = a].
            p
                | so #[m s_1 \in k^\times] then #[m a\in {k^{\times}}^2]
                me (a,-b) = 1\implies (-a,\delta) =1
                | as both are units.

            p
                | Now #[m b = \alpha\beta  \equiv 0 \pmod {\pi_K}]
                |so
                me x^2 - 2ax  + \delta \equiv (a-A)^2 \pmod {\pi_K}
                | same Taylor expansion gives
                me f(x,y) = y^2 - x^3 + 2ax^2 - \delta x
                me = f(x,y) - f(A,0) = (y - s_3(x-A))(y - s_4(x-A)) + h.o.t.
                | so #[m s_3 = -s_4 ] and #[m s_3 s_4 = 2a], #[m s_3 ^2 = -2a]
                | hence
                me (a, -b)(-2a,\delta)
                | split multiplicative
                me -2a \in {K^\times}^2
                | ,
            p
                | So we should use this Hilbert symbol instead, it doesn't change the real case.
            p
                | If  #[m E] has non-split multiplicative reduction
                me.
                    \frac{c_E}{c_{E'}} =
                    \begin{cases}
                    1,\amp\text{ if } v(\Delta_E),v(\Delta_{E'}) \text{ even}\\
                    2,\amp\text{ if } v(\Delta_{E'}) \text{ odd}\\
                    \frac12\amp\text{ if } v(\Delta_E) \text{ odd}
                    \end{cases}

                me.
                    \implies (-1)^{\ord_2 \frac{c_E}{c_{E'}}} =
                    \begin{cases}
                    1,\\
                    -1,\\
                    -1,\\
                    \end{cases}
                | done since #[m a,-2a] precisely not squares.
            p
                | What are these invariants purely in theory?



section
    title Abelian varieties
    introduction
        aside: p Lecture ? 2/4/2018
        p
            | What about generalising this method to abelian varieties?
        p
            | For #[m p] odd Coates et. al. (ppav with #[m p]-cyclic isogenies and local constraints)

        p
            | For #[m p = 2].

        p
            | Recall let #[m X,Y/K] be abelian varieties over a number field and suppose that #[m \Psi\colon X\to Y] is an isogeny, then #[m \Psi^\vee \colon Y^\vee \to X^\vee] its dual.
            | Then
            men#eqn-parity-dagger \frac{Q(\Psi^\vee)}{Q(\Psi)} = \frac {|Y(K)_\tors|}{|X(K)_\tors|}\frac {|Y^\vee(K)_\tors|}{|X^\vee(K)_\tors|} \frac{\prod_v c(X/K_v)}{\prod_v c(Y/K_v)} \frac{\Omega_X}{\Omega_Y} \prod_{p| \deg \Psi} \frac{|\Sha_0(X) \lb p^\infty\rb |}{|\Sha_0(Y) \lb p^\infty\rb |}
            | on the other hand we showed that if #[m \Psi \Psi^\vee = \lb p \rb] then
            me \frac{Q(\Psi^\vee)}{Q(\Psi)}\equiv p^{\rk_p(X/K)} \pmod {{K^\times}^2}
            | note that in this case #[m \deg \psi =  p^{\dim (X)}].
        p
            | To be able to use the same method we need to compute the RHS of #[xref(ref="eqn-parity-dagger")/].
        p
            | For #[m E] since #[m E\simeq E^\vee] and #[m |\Sha_0(E)| = \square ], this only meant computing
            me \prod_v \frac{c(E/k)}{c(E'/k)} \frac{\Omega_E}{\Omega_{E'}}
            | .
        p
            | First consider a ppav #[m X/K] s.t.
            mdn
                mrow #[xref(ref="eqn-parity-dagger")/] \equiv \frac{\prod_v c(X/K_v)}{\prod_v c(Y/K_v)} \frac{\Omega_X}{\Omega_Y} \frac{|\Sha_0(X) \lb p^\infty\rb |}{|\Sha_0(Y) \lb p^\infty\rb |} \pmod{{K^\times}^\vee}
            ol
                li
                    p
                        | Can we compute
                        men \frac{\prod_v c(X/K_v)}{\prod_v c(Y/K_v)} \frac{\Omega_X}{\Omega_Y}
                        |?
                    p
                        |   Leads us to Jacobians of hyperelliptic curves of genus #[m g]
                li
                    p
                        | Can we compute
                        men \frac{|\Sha_0(X) \lb p^\infty\rb |}{|\Sha_0(Y) \lb p^\infty\rb |}
                        |?
                        |   Leads us to Jacobians of hyperelliptic curves of genus #[m g]
                li
                    p
                        | Need an isogeny #[m \Psi] of degree #[m 2^g] s.t.
                        me \Psi \colon J  \to J'
                        | i.e. the codomain must be a Jacobian of a hyperelliptic curve otherwise we cannot compute 1. or 2.

        p
            | To satisfy 1., 2. and 3. we take #[m g = 2] because of the following:
        theorem
            title González, Josep, Jordi Guardia, and Victor Rotger. Abelian surfaces of GL2-type as Jacobians of curves. arXiv preprint math/0409352 (2004)
            // #[xref(ref="bib-gonzales-guardia-rotger")/]
            statement: p
                | Let #[m A/K] be a principally polarized abelian surface defined over a number field. Then #[m A] is one of the following types
                ul
                    li
                        me A/K \simeq_K J(C)
                        | where #[m C/K] is a smooth genus 2 curve.
                    li
                        me A/K \simeq_K C_1 \times C_2
                        | where #[m C_1,C_2/K] are elliptic curves defined over #[m K].

                    li
                        me A/K \simeq_K \Res_{F/K} C
                        | where #[m \Res_{F/K} C] is the Weil restriction of an elliptic curve defined over  a quadratic extension #[m F/K].

        remark
            p
                | The parity of the rank of #[m A/K] in the last two cases can be computed from that of the underlying elliptic curves.

        p
            | We will concentrate on #[m A\simeq_K J(C)],
            me C\colon y^2 = f(x)
            | for #[m \deg (f ) = 6].

        p
            | The generalisation of a 2-isogeny is called a Richelot isogeny.

        p
            | Plan:
            ol
                li Review of hyperelliptic curves and their Jacobians.
                li Richelot isogeny
                li Compute contribution of the real places
                li Compute Tamagawa numbers/local root numbers
                li Compute #[m |\Sha_0(J) \lb 2^\infty \rb|] up to squares
                li Find and prove the right error term

    subsection
        title Review of hyperelliptic curves and Jacobians

        p
            | See Stoll's notes.

        p
            | By a hyperelliptic curve #[m C] over a number field #[m K] given my
            me C/K \colon y^2 = f(x)
            | of genus #[m g] where #[m f(x) \in K\lb x\rb] of degree #[m 2g+1] or #[m 2g+2] with no multiple roots, we mean the pair of affine patches
            me U_x \colon y^2 = f(x)
            me U_t \colon v^2 = t^{2g+2} f\left(\frac 1t\right)

            | glued together along the maps
            me x = \frac 1t,\, y=  \frac{v}{t^{g+1}}
            | .
            | We refer to as the points  at #[m \infty] (i.e. #[m C \smallsetminus U_x]) the points with #[m t  = 0] on #[m U_t].
        p
            | Explicitly denote by #[m c] the leading term of #[m f(x)].

        p
            | If #[m f(x)] is of degree #[m 2g+1] then
            me U_x \colon y^2= c\prod_{i=1}^{2g+1} (x- r_i)
            me U_t \colon v^2= tc\prod_{i=1}^{2g+1} (tr_i- 1)
            | we denote #[m P_\infty = (0,1)] the only point at infinity with #[m t=0].
        p
            | Otherwise if #[m f(x)] is of degree #[m 2g+2] then
            me U_x \colon y^2= c\prod_{i=1}^{2g+2} (x- r_i)
            me U_t \colon v^2= c\prod_{i=1}^{2g+2} (tr_i- 1)
            | we denote #[m P_\infty^\pm = (0,\pm \sqrt{c})] the two points on #[m U_t] with #[m t  = 0].

        paragraphs
            title Divisors and the picard group
            p
                | Let #[m G_K] be the absolute galois group of #[m K], recall that #[m G_K] acts on
                me C(K^\sep)
                | via its action on coordinates.

            definition
                statement
                    p
                        | A divisor #[m D] on #[m C] is a formal sum
                        me \sum_{P\in C(K^\sep)} n_P P
                        | where #[m n_P \in \ZZ] and #[m n_P  = 0] for all but finitely many #[m P \in C(K^\sep)].
                        | The integer #[m n_P] is called the multiplicity of #[m P] in #[m D] and #[m \deg(D) = \sum_{P} n_P] is the degree of #[m D].
                    p
                        | Divisors on #[m C] are elements of the free abelian group on the set of points #[m P\in C(K^\sep)].
                        | Denote by #[m \Div(C)] the group of divisors on #[m C].

            definition
                statement
                    p
                        | A divisor
                        me D = \sum_{P\in C(F)} n_P P
                        | for some Galois extension #[m F|K].
                        | We say it is #[m K]-rational, or defined over #[m K] if
                        me D^\sigma = D \,\forall \sigma \in \Gal F K
                        | .

            example
                statement: p
                    me C \colon y^2 = f(x)
                    me \alpha \in K
                    me P = (\alpha, \sqrt {f(\alpha)})
                    me \bar P = (\alpha, -\sqrt {f(\alpha)})
                    | then
                    me D = P + \bar P
                    | is a #[m K]-rational divisor.

            definition
                statement: p
                    | Let #[m f] be a non-zero rational function on #[m C].
                    | Define
                    me \lb f \rb =  \sum_{P \in C} \ord_P (f) P
                    |where the multiplicity of #[m P ] in #[m \lb f\rb] is given by the order of vanishing of #[m f ] at #[m P].
                    | These divisors are called principal divisors, the group of such is denote #[m \Princ(P)].
                    | Note that these are all of degree 0.

            definition
                statement: p
                    | The picard group of #[m C] is defined to be
                    me \Pic(C) = \Div(C)/ \Princ(P)
                    | . Note that this inherits a notion of degree from #[m \Div(C)].

            theorem
                statement: p
                    | Let #[m C] be a smooth, projective, absolutely irreducible curve of genus #[m g] over some field #[m K].
                    | Then there exists an abelian variety #[m J] of dimension #[m g] over #[m K] s.t. for each field
                    me K \subseteq L \subseteq K^\sep
                    me J(L) =  \Pic_C^0(L)

            definition
                statement: p
                    | #[m J] is called the Jacobian variety of #[m C].

            remark: p
                | #[m J] is a projective variety (abelian), thus it can be embedded in some projective space #[m \PP^N] over #[m K].
                | One can show that
                me N = 4^g  - 1
                | always works for hyperelliptic curves.

            p

                | This is too large to work with an explicit model for #[m J] instead we will work with the curve #[m C].

        aside: p Lecture ? 4/4/2018

        paragraphs
            title Jacobians of genus 2 curves

            p

                | Let #[m C] be a hyperelliptic curve of genus 2 defined over #[m K].

                me C\colon y^2 = f(x)
                | with #[m f(x) \in K\lb x \rb] of degree 6.

            p
                | Points on #[m C(\overline K)] and #[m J(\overline K)]:
            p
                | A point #[m D] on #[m J(\overline K)] is given by  a divisor on #[m C] of the form
                me D = P + Q - P_{\infty}^+ - P_\infty^{-}
                | for some #[m P,Q \in C(\overline K)].
                | For #[m D] to be defined over #[m K] either #[m P,Q \in C(K)] or #[m P = Q^\sigma] for #[m \sigma \in \Gal F K] where #[m \lb F : K \rb = 2].

            remark: p
                | If #[m P = (x,y)] and #[m P' = (x,-y)]  then
                me D  = P + Q - P_\infty^+ - P_\infty^-
                | is zero in #[m J(\overline K)].


            p
                | Addition:
            p
                | Choose 4 points #[m P,P',Q,Q'\in C(\overline K)] (in general position to make it easier).
            figure
                caption/
                image: latex-image.
                    \begin{tikzpicture}
                      \begin{axis}[hide axis]
                        \addplot +[no markers,
                          raw gnuplot,
                          thick,
                          empty line = jump, % not strictly necessary, as this is the default behaviour in the development version of PGFPlots
                          id = g2addition,
                          ] gnuplot {
                          set contour base;
                          set cntrparam levels discrete 0.003;
                          unset surface;
                          set view map;
                          set samples 700;
                          set isosamples 700;
                          splot y^2 - (x-1)*(x-2)*(x-3)*(x+1)*(x+2)*(x+3);
                          splot y - (x^3  - 3*x + 7)/5;
                        };
                      \end{axis}
                    \end{tikzpicture}


            p
                | We can find  a cubic polynomial #[m y = p(x)] through the four points.
                | It also intersects at two additional points #[m S,S'] so that
                me [y - p(x)]  = P + P' + Q + Q' + S + S' - 3P_\infty^+ - 3P_\infty^-
                me (P + P'  - P_\infty^+ - P_\infty^-)+( Q + Q'  - P_\infty^+ - P_\infty^-) =-( S + S' - P_\infty^+ - P_\infty^-)
                | hence
                me \underbrace{\lb P , P'\rb}_{=P + P' - P_\infty^+ - P_\infty^-}  + \lb Q , Q' \rb = \lb R, R'\rb
                | where #[m \lb R , R'\rb = -\lb S, S'\rb].
                | Where negation is taking negative of all #[m y]-coordinates.

            p
                | So what is 2-torsion?
            lemma
                statement: p
                    | Each non-zero element of #[m J(\overline K) \lb 2 \rb] may be uniquely represented by the following pairs of points on #[m C(\overline K)],
                    | let #[m x_1, \ldots, x_6] be the roots of #[m f(x)] then
                    me J(\overline 2 ) \lb  2 \rb  = \{ [T_i, T_k], i \ne k\},\,T_i = (x_i,0) \in C(\overline K)
                    | .

            remark
                p
                    | For the Richelot isogeny #[m \phi]:
                    me.
                        \xymatrix{
                        J \ar[r]^\phi &amp; J' \ar[r]^{\phi^\vee} &amp;  J\\
                        C \ar@{^{(}->}[u] \ar[r]_{\Gamma} &amp; C' \ar@{^{(}->}[u] &amp;
                        }
                    | where #[m \phi^\vee \circ \phi = \lb 2 \rb] and #[m \Gamma] is a correspondence.

    subsection
        title Richelot isogenies and the Richelot construction

        p
            | Richelot isogenies are defined for Jacobians of genus 2 curves, they split multiplication by 2.
            | Their codomain is the Jacobian of a curve, a model of which is explicitly given by the Richelot construction.

        definition#def-richelot-op
            title The Richelot operator
            statement
                p
                    | Given two polynomials #[m P(x), Q(x)\in K\lb x\rb] of degree at most 2 we define the #[term Richelot operator] #[m \lb -, - \rb] by
                    me \lb P(x),Q(x) \rb =  P'(x) Q(x) - Q'(x) P(x)
                    | .
        definition#def-richelot-poly
            title Richelot polynomials
            statement
                p
                    | We say that a polynomial #[m G(x) \in K \lb x \rb] of degree 5 or 6 is a #[term Richelot polynomial] over #[m K] if we can fix a factorisation
                    me G(x) = G_0(x) G_1(x) G_2(x)
                    | where each #[m G_i] is of degree at  most 2, defined over #[m \overline K] and defined over #[m K] as a set.
                p
                    | Write
                    me G_i(x) = g_{i2} x^2+ g_{i1} x +g_{i0}  = g_i(x-\alpha_i)(x-\beta_i)
                    | for its factorisation over #[m \overline K] and define
                    me \Delta_G = \det((g_{ij})_{0\le i, j \le2})
                    | .

        definition#def-richelot-dual-poly
            title Richelot dual polynomials
            statement: p
                | To a Richelot polynomial #[m G(x)] with a fixed factorisation
                me G(x) =G_0(x) G_1(x) G_2(x)
                | such that #[m \Delta_G \ne 0].
                | We associate its #[term Richelot dual polynomial] #[m F(x)] given by
                me F(x) = \prod_{i=1}^3 F_i(x),\,F_i(x) =\frac{1}{\Delta_G} \lb G_{i+1}(x), G_{i+2}(x)\rb
                | where we take indices mod 3.

                | Write #[m F_i(x) = f_i(x-A_i)(x-B_i)]

        p
            | #[m \Delta_G] may not be defined over #[m K] but #[m \Delta_G^2] is.

        definition#def-richelot-curve
            title Richelot (dual) curves
            statement
                p
                    | We say that a hyperelliptic curve #[m C/K] of genus 2 is a #[term Richelot curve] over #[m K] if it is given by #[m y^2  = G(x)] together with the factorisation
                    me G(x) =G_0(x) G_1(x) G_2(x)
                    | as a Richelot polynomial over #[m K] such that #[m \Delta_G \ne 0].
                p
                    | To a Richelot curve #[m C/K] we associate its #[term Richelot dual curve] #[m \widehat C] given by
                    me \widehat C \colon y^2    =F(x)
                    | where #[m F(x)] is the Richelot dual polynomial of #[m G(x)] with respect to the given factorisation.


        remark
            p
                | Let #[m G(x) \in K \lb x \rb] be a polynomial of degree 5 or 6.
                | Denote by #[m K_G] its splitting field.
                | Then  the conditions for #[m G(x) ] to be a Richelot polynomial can be rephrased as
                me \Gal{K_G}{K} \subseteq C_2^3 \rtimes S_3 \subseteq S_6
                me G(x) =G_0(x) G_1(x) G_2(x)

        paragraphs
            title Richelot isogenies

            definition#def-richelot-isog
                title Richelot isogenies
                statement: p
                    | Let #[m C/ K] be  a Richelot curve with fixed factorisation
                    me G(x) =G_0(x) G_1(x) G_2(x)
                    | .
                    | Let #[m J] be its Jacobian, consider the 2-torsion points of #[m J(\overline K)] defined by the quadratic factorisation of #[m G(x)].
                    me D_i = \lb P_i, Q_i\rb
                    | where #[m P_i = (\alpha_i, 0)], #[m Q_i = (\beta_i, 0)].
                    | Then the isogeny over #[m K] for #[m J] whose kernel is #[m \{0, D_1, D_2, D_3\}] is called a #[term Richelot isogeny].

            p
                | We say that a Jacobian admits a Richelot isogeny over #[m K] if its underlying curve is a Richelot curve #[m /K].

            theorem
                statement: p
                    | Let #[m C/K] be a Richelot curve with fixed factorisation
                    me G(x) =G_0(x) G_1(x) G_2(x)
                    | . Let #[m \widehat C /K] be its Richelot dual curve and let #[m \phi] denote the associated Richelot isogeny on #[m J].
                    | Then #[m \phi\colon J \to \widehat J] where #[m \widehat J] is the Jacobian of #[m \widehat C] and moreover #[m \hat \phi \phi = \lb 2\rb].

        aside: p Lecture ? 9/4/2018

        paragraphs
            title Brauer groups Galois cohomology and local invariants (Angus)

            p
                | Reference Milne's CFT.

            p
                | Central simple algebras:
            p
                | We will consider finite dimensional #[m k]-algebra for #[m k] a field.

            definition
                statement: p
                    | A #[m k]-algebra #[m A] is central if the center #[m Z(A) = k].

                    | A #[m k]-algebra is simple if the only two sided ideals are #[m A] and #[m (0)].

            example
                statement: p
                    | The matrix algebra #[m M_n(k)] is central simple for #[m k].

            example
                statement: p
                    | A quaternion algebra like #[m \HH = \RR \{i,j,k\}] is central simple for #[m k].

            example
                statement: p
                    | A division algebra is simple.

            definition
                statement: p
                    | Two central simple #[m k]-algebras #[m A,B] are similar, if there exists #[m m,n \in \ZZ_{\gt 0}] s.t. #[m A \otimes_k M_m(k) \simeq B \otimes_k M_n(k)].
                    | Denote this by #[m A\sim B].

            definition#def-brauer-gp-field
                title Brauer groups
                statement: p
                    | The #[term Brauer group] of a field #[m k] denoted #[m \Br(k)] is the set of similarity classes of central simple algebras #[m \lb A \rb] with operation
                    me \lb A \rb \lb B \rb = \lb A \otimes B \rb
                    | .

            remark
                p
                    ol
                        li
                            | The class #[m \lb M_n(k)\rb] is the identity for all #[m n].
                        li
                            | The operation is well defined.
                        li
                            | Given #[m A] let #[m A^\op] be the algebra with order of multiplication reversed.
                            | Then
                            me A \otimes_k A^\op \xrightarrow \sim \End_k(A) \simeq M_{\dim_k(A)} (k)
                            me (a\otimes a') \mapsto (v \mapsto a v a')
                            | .
                            | So
                            me \lb A \rb\inv = \lb A^\op \rb
                            | .


            p
                | Galois cohomology:

            theorem
                title Noether-Skolem
                statement: p
                    | Let #[m A, B] be central simple #[m k]-algebras and #[m f,g\colon A  \to B] a #[m k]-algebra morphism.
                    | Then there exists
                    me b \in B^\times
                    |such that
                    me f(a) = bg(a) b\inv ,\,\forall a \in A
                    | .

            p
                | Let #[m A] be a central simple #[m k]-algebra with maximal subfield #[m L/k].
            p
                | Let #[m \sigma \in \absgal k], it induces a map
                me \sigma \colon  A \to A
                |, comparing this to the identity Noether-Skolem gives an element
                me e_\sigma \text{ s.t. } \sigma a = e_\sigma a e_\sigma\inv,\,\forall a \in L
                | defined up to multiplication by #[m L^\times].
            p
                | Given another #[m \tau \in \absgal k] I have
                me e_{\sigma\tau} a e_{\sigma\tau}\inv = \sigma(\tau a) = e_\sigma e_\tau a e_\tau\inv e_\sigma\inv
                | thus there exists
                me \phi(\sigma,\tau) \in L^\times
                | s.t.
                me e_{\sigma\tau} = \phi(\sigma,\tau) e_\sigma e_\tau
                | this gives a map

                me \{\text{central simple algebras}/k \} \to H^2( \absgal k, \overline k ^\times)
                |.
            theorem
                statement: p
                    | This descends to
                    me \Br(k) \simeq H^2( \absgal k, \overline k ^\times)
                    | .

            p
                | Some special #[m k].

            theorem
                title Wedderburn
                statement: p
                    | Every central simple #[m k]-algebra is isomorphic to #[m M_n(D)] for #[m D] a division #[m k]-algebra.

            proposition
                statement: p
                    | If #[m k  = \overline k] then any division #[m k]-algebra #[m D] is isomorphic to #[m k].
                    | Thus #[m \Br(k) = 0].


            theorem
                title Wedderburn
                statement: p
                    | Every finite division ring is a field.
                    | So if #[m k] is a finite field then #[m \Br(k) =  0].

            theorem
                title Frobenius
                statement: p
                    | Every central division #[m \RR]-algebra is isomorphic to either #[m \RR] or #[m \HH].
                    | Thus #[m \Br(\RR) \simeq \ZZ/2].


            p
                | Let #[m k] be a  non-archimidean local field with valuation
                me v \colon k^\times \to \ZZ
                | for a central division algebra #[m D] there exists #[m n \in \ZZ] s.t.
                me v \colon D ^\times \to \frac 1n \ZZ
                |.

            p
                | Consider a maximal unramified subfield
                me K  \subseteq L \subseteq D
                | with #[m \sigma\in \Gal LK] lifting frobenius.

            p
                | Noether-Skolem gives #[m \alpha  \in D^\times] s.t.
                me \sigma x = \alpha  x \alpha \inv,\,\forall x \in L
                | up to #[m L^\times].
            p
                | If we take #[m \alpha ' = c\alpha ] for #[m c\in L^\times] we can compute
                me v(\alpha ') = v (c) + v(\alpha ) \equiv v(\alpha ) \pmod \ZZ
                | .
            p
                | We get a map
                me \{\text{central division algebras}/k \} \to \QQ/\ZZ
                | .
            theorem
                statement: p
                    | This descends to an isomorphism
                    me \Br(k) \simeq \QQ/\ZZ
                    | .

            p
                | If #[m F] is a number field with  a place #[m v\in  |F|]
                | get a map
                me \mathrm{inv}_v \colon \Br(F) \to \Br(F_v) \simeq \begin{cases} 0 ,\amp F_v = \CC,\\ \ZZ/2,\amp F_v = \RR,\\ \QQ/\ZZ,\amp F_v\text{ nonarch}.\end{cases}
                |.

            p
                | Global CFT gives an exact seq
                me 0 \to \Br(F) \to \bigoplus_v \Br(F_v) \to \QQ/\ZZ \to 0
                | .

        paragraphs
            title Root numbers of elliptic curves  (Ricky)

            p
                | Based on Rohrlich's article elliptic curves and the Weil-Deligne group
            p
                | #[m K] non-archimidean local field, #[m \overline K] is its separable closure.
                me \phi = (x\mapsto x^q)\inv\in \absgal k,\,q = |k|
                | #[m \Phi] some lift of #[m \phi] in #[m \absgal K].
            p
                | #[m W(\overline K / K) = ] Weil group, the preimage of #[m \langle \phi\rangle] in #[m \absgal k] under #[m G_K \twoheadrightarrow G_k].

            p
                | We consider #[m \sigma \colon W( \overline K/K) \to \GL(V)], representations over #[m V/\CC] (always cts.)

            p
                | Say #[m \sigma] is of Galois type if  it factors through a finite quotient.

            p
                | Another source of examples is
                me \omega \colon W \to \CC^\times
                | given by
                me \omega(I) = \{1\}
                | where
                me I =\ker(G_K \to G_k)
                | and #[m \omega(\Phi) = q\inv].

            p
                | Fact, all irreducible #[m \sigma \cong \rho \otimes \omega^s] for some #[m s \in \CC] and #[m \rho] of Galois type.

            definition#def-weil-deligne-gp
                title The Weil-Deligne group
                statement: p
                    | The #[term Weil-Deligne group] is
                    me W'(\overline K / K) = W(\overline K/K) \ltimes \CC
                    | where #[m W] acts on #[m \CC] via #[m \omega]
                    me g z g\inv = \omega(g) z,\,g\in W(\overline K/ K),z \in \CC
                    | .

            p
                | Upshot:
                | Representations #[m \sigma'] of #[m W'] are the same as #[m (\sigma, N)] where
                me \sigma\colon W \to \GL(V)
                | a representation and #[m N] is a nilpotent linear operator on #[m V].
                | Satisfying
                me \sigma(g) N \sigma(g)\inv = \omega(g) N
                | .
            p
                | One motivation for studying those is  a general construction of Grothendieck and Deligne which turn an #[m l]-adic representation of #[m G_K] into a representation of #[m W'] (given #[m i\colon \QQ_l \hookrightarrow \CC]).

            example
                statement: p
                    me \sprep(n) = \CC^n
                    | with action of #[m W'] given by
                    me \sigma(g) e_j = \omega(g)^j e_j,\,\forall g \in W
                    me Ne_ j = e_{j+1},\, Ne_n = 0
                    | check relation #[m \sigma N \sigma\inv = \omega N].

            p
                | We want to define #[m \epsilon ]-factors for representations of #[m W'].
                | We need two choices:
                me \psi \colon K\to \CC^\times
                | an additive character of #[m K].
                | And
                me \diff x
                | a Haar measure on #[m K].

            p
                | Then
                me \epsilon (\sigma ', \psi , \diff x) = \epsilon ( \sigma , \psi ,\diff x) \delta (\sigma ')
                | where
                me \delta (\sigma ') = \det(-N | V^I / V_N^I)
                | and #[m \epsilon (\sigma , \psi , \diff x)] is defined by the following proposition.

            proposition
                title Deligne-Langlands
                statement: p
                    | There exists a unique function #[m \epsilon (\sigma ,\psi \diff x)] satisfying
                    ol
                        li
                            | #[m \epsilon (*, \psi , \diff x)] is multiplicative in short exact sequences.
                        li
                            | If #[m L/K] is finite then
                            me \epsilon (\Ind_{L/K} \rho , \psi , \diff x) = \epsilon (\rho , \psi  \circ \trace_{L/K}, \diff x_L) \cdot \left( \epsilon (\Ind_{L/K} 1_L, \psi , \diff x) / \epsilon (1_L, \psi \circ \trace_{L/K}, \diff x_L)\right)^{\dim \rho }
                        li
                            | For #[m \chi ] a character
                            me \epsilon (, \chi , \psi , \diff x)
                            | agrees with the ones defined in Tate's thesis.
                            | They're both given by an integral formula.

            definition#def-root-num-wd
                title Root numbers
                statement: p
                    | The #[term root number] of #[m \sigma '] is defined to be
                    me w(\sigma ', \psi ) = \frac{\epsilon (\sigma ', 'y, \diff x)}{|{\epsilon (\sigma ', 'y, \diff x)}|}
                    |.


            p
                | For #[m E/K] an elliptic curve we have a representation on #[m V_l^*] (#[m l \ne p]).

            p
                | Using the Grothendieck-Deligne construction, let #[m \sigma _{E/K}] be a representation of #[m W'] it has the following property
                ul
                    li
                        | #[m E] pot. good reduction then
                        me N_{E/K} = 0
                        | and #[m \sigma_{E/K}] is semisimple.
                        | #[m E] has good reduction iff #[m \sigma _{E/K}] is unramified.
                    li
                        | #[m E] has potential multiplicative reduction implies that we can take #[m \chi ] a character of #[m W] with #[m \chi ^2 = 1], so that
                        me E^\chi
                        | has split multiplicative reduction.
                        | Then
                        me \sigma _{E/K}' \simeq \chi  \omega \inv \otimes \sprep(2)
                        | #[m \chi ] is trivial / unramified and non-trivial / ramified according to #[m E] having split / non-split / additive reduction.

                    li
                        | #[m \sigma _{E/K}'] is essentially symplectic.
                        | #[m W(E/K) = W(\sigma _{E/K}')] is independent of #[m \psi ] and must be #[m \pm 1].

            proposition
                statement: p
                    ol
                        li
                            | #[m E] has good reduction implies #[m W(E/K) = 1].
                        li
                            | #[m E] potentially multiplicative reduction implies
                            me W(E/K) = \begin{cases} -1 \amp \text{split}\\ 1 \amp \text{nonsplit}\end{cases}
                            | .
                            | If additive reduction take #[m \xi ] quadratic character s.t.
                            me E^\xi
                            | has split multiplicative reduction and #[m W(E/K) = \xi (-1)].


        paragraphs
            title #[m \Sha] (Sachi)
            aside: p Lecture ? 11/4/2018

            p
                | Suppose   #[m G] is  a finite abelian group with a non-degenerate alternating, bilinear paring
                me \Gamma \colon G \times G  \to \QQ/\ZZ
                | then there exists #[m H] s.t. #[m G \cong H\times H].
            p
                | Nondegeneracy is the property that: If #[m \Gamma (v,w) = 0] for all #[m w \in G] then #[m w=  0].
            p
                | Alternating: For all #[m v \in G], #[m \Gamma (v,v ) = 0].
                | (this implies skew-symmetry).

            p
                | Analogous theorem:
            p
                | Symplectic space if #[m V] a vector space with non-degenerate alternating bilinear pairing, #[m \omega ] has a decomposition.
                me V = W \oplus W^*
                | where #[m W] is Lagrangian.

            p
                | Proof is via induction on the dimension of #[m V].
                | Fix #[m v\in V]. #[m \exists W] s.t. #[m \omega (v,w) = 1], scalar nondegeneracy.
            p
                | Define #[m W = \{z\in V : \omega (z,w) = 0, \omega (v,z) = 0\}].
            p
                me \space(W,V) \cap W = 0
                | so restrict #[m \omega ] to #[m W], induct.
            proof
                title Proof of the theorem
                p
                    | Trivial group #[m \checkmark].

                p
                    | Reduce to the case of a #[m p]-group, #[m G] a #[m p]-group.
                    | Fix #[m x] of maximal order in #[m G], #[m p^n].
                    | There exists #[m y] such that #[m \Gamma (x,y)  = \frac 1{p^n}].
                    | If not then #[m \Gamma (p^{n-1}x,y) = 0] for all #[m y \in G] so this contradicts non-degeneracy.
                    | Any #[m y] has maximal order also since
                    me 0 \ne p^{n-1} \Gamma (x,y)  = \Gamma (x, p^{n-1} y)
                    | .
                p
                    | Next we want to show #[m \langle x \rangle  \cap \langle y \rangle = 0].
                    | If #[m mx = ny] for some #[m 0 \lt m, n \lt p^n] then
                    me 0 = m\Gamma (x,y) = \Gamma (x, mx) = n\Gamma (x,y) \ne 0
                    | .
                p
                    | Define
                    me H = \{ z : \Gamma (x,z) = \Gamma (y,z) = 0\}
                    | claim:
                    me G \cong ( \langle x\rangle \oplus \langle y \rangle ) \oplus H
                    | .
                p
                    | Proof of claim:
                    | If #[m g \in G]
                    me \gamma  \coloneqq g - p^n \Gamma (y,g) x - p^n\Gamma (x, g) y
                    | so
                    me  \Gamma (x,\gamma ) = \Gamma (x,g) - p^n \Gamma (y, g) \cancelto{0}{\Gamma (x,x)} - p^n \Gamma (x,g) \underbrace{\Gamma (x,y)}_{1/p^n} = 0
                    | here we used alternating.

                p
                    | Then #[m \Gamma ] restricts to a non-degenerate alternating bilinear pairing on #[m H].

        remark
            p
                | For a PPAV we do not always have an alternating pairing, sometimes just skew-symmetric, or nothing!
                | So Sha can be square, twice a square, or arbitrary.
                | See Poonen-Stoll, Stein?

        paragraphs
            title Complete 2-descent (Oana)

            p
                | Let
                me y^2 = x(x-5)(x+5)
                | #[url(href="http://www.lmfdb.org/EllipticCurve/Q/800/d/3")/],
                | then
                me \Delta  = 10^6
                | so the bad primes are #[m 2,5].

            p
                | #[m \#\tilde E(\FF_3) = 4].
                me E_\tors(\QQ) \hookrightarrow \tilde E(\FF_3)
                | so
                me E_\tors(\QQ) [2]  = \{0, (0,0), (5,0), (-5,0)\}
                | .
                me E\lb 2 \rb \subseteq E(\QQ)
                | .
            p
                | #[m S  = \{2,5, \infty \} \subseteq M_\QQ].
                me \QQ(S, 2) = \{ b\in \QQ^\times / (\QQ^\times)^2 : \ord_p(b) \equiv  0 \pmod 2,\,\forall p\not\in S\}
                | a complete set of coset representatives is
                me \{\pm 1, \pm 2, \pm 5, \pm 10\}
                | which has 8 elements.
                | Consider
                me E(\QQ)/2E(\QQ)  \to \QQ(S,2)\times \QQ(S,2)
                me e_0 = 0, e_1=5, e_2 =-5
                | .
            p
                me 0 \mapsto (1,1)
                me (0,0) \mapsto (-1,-5)
                me (0,5) \mapsto (5,2)
                me (0,-5) \mapsto (-5,10)
            p
                | does the system
                me b_1 z_1^2 - b_2 z_2^2 = 5
                me b_1 z_1^2 - b_1 b_2 z_3^2 = -5
                | have a solution for pairs #[m (b_1, b_2) \in \QQ(S,2)^2]  and #[m z_1, z_2, z_3 \in \QQ]?

            p
                | If #[m b_1 \lt 0, b_2 \gt 0] or #[m b_1 \gt 0 , b_2 \lt 0] then we have no solution.

            table
                caption Images
                tabular(top="major",left="major",right="major",bottom="major")
                    | #[col(right="minor")/] #[col(right="minor")/] #[col/]
                    row(bottom="minor") #[cell: m b_1] #[cell: m b_2 ] #[cell reason/point?]
                    row #[cell 1] #[cell 1] #[cell point 0]
                    row #[cell 1] #[cell 2] #[cell ]
                    row #[cell 1] #[cell 5] #[cell ]
                    row #[cell 5] #[cell 2] #[cell point (0,5)]
                    row #[cell -1] #[cell -1] #[cell point (-4,6)]
                    row #[cell -5] #[cell -2] #[cell point (0,5) + (-4,6)]
            p
                | Reason if #[m \legendre ap = -1] and #[m x^2 = ay^2 \pmod p] then
                me x \equiv  0 \equiv  y \pmod p
                | then
                me b_1(z_1^2 - b_2 z_3^2) = -5
                | If #[m 5\nmid b_1] and #[m \legendre{b_2} 5 = -1] then
                me 5|z_3
                | we have #[m z_3 \in 5\ZZ_3 \cap \QQ]
                me |z_3 |_5 \le \frac 15
                | .


            p
                | We reverse engineer #[m (-4,6) \in E(\QQ)].

        paragraphs
            title Weil-Châtelet groups (Aash, Asra)

            p
                | I have an elliptic curve #[m E/K], then #[m C/K] a smooth curve is a PHS if
                me \exists \mu  \colon E(\overline K) \times C(\overline K) \to C(\overline K)
                me (P,p) \mapsto p+ P
                | .

                | Such that #[m \mu ] is defined over #[m K] and #[m (P+Q) + p = P+(Q+p)] and for all #[m p,q \in C(\overline K)] there exists a unique #[m P\in E(\overline K)] s.t. #[m \mu (P,p) = q].

            p
                | We say two PHS #[m C,C'] are equivalent if
                me \phi /K \colon C \to C'
                | which respects the action of #[m E].
            p
                | #[m \forall P \in E, p\in C]
                me \phi (P+ p) = P+ \phi (p)
                me \phi ( \mu _C (P,p)) = \mu _{C'} (P, \phi (P))
                | .
            p
                | #[m \operatorname{WC}(E)] is set of the equivalence classes of PHS's.

            p
                me WC(E/K) \leftrightarrow H^1(G_{\overline K/K}, E)
                | .

            proposition
                title Weil
                statement: p
                    | Let #[m H_1, H_2] be homogeneous spaces for an algebraic group  #[m G/K].
                    | There exists  #[m H] a PHS over #[m K] and
                    me f \colon H_1 \times H_2 \to G
                    me f(P+p, Q + q) = P + Q +f(p,q)
                    |where #[m P, Q \in Q], #[m p \in H_1, q \in H_2] this #[m H] is unique up to PHS isomorphism.
                    | If #[m \mathcal H_1, \mathcal H_2] are the classes of #[m H_1, H_2] we call #[m \mathcal H_1 + \mathcal H_2] the class of #[m H] (above).
                    | This defines a group structure.
                    ol
                        li
                            | Well defined binary operation
                        li
                            | Identity: call class of #[m G], #[m \mathcal H_0].

                    me G \times H \to H
                    me (P,p) \mapsto P+ p
                    me \mathcal H_0+ \mathcal H = \mathcal H'
                    | for any #[m \mathcal H].
                    | Inverse: Say #[m H] is a PHS, consider  #[m H^-]
                    me \mu  \colon H \times E \to H
                    me p, P \mapsto p+P
                    me \mu _- \colon  H^- \times E' \to H^-
                    me p,P \to p + (-P)
                    me \phi  \colon H \times H^- \to E
                    me (a,b) \mapsto v(a,b)
                    | #[m P = v(a,b) \in E] s.t. #[m P+ b = a].
                    | Associativity: #[m H_1, H_2, H_3]
                    me H_1, H_2 \to H_{12}


            aside: p Lecture ? 18/4/2018

            p
                me C \colon y^2 = f(x) = p_1(x)p_2(x) p_3(x) \to C' \colon y^2 = \frac 1\Delta  g_1(x)g_2(x)g_3(x)
                me J(C) \xrightarrow{\text{Richelot isogeny}} J'(C')

            p
                | We showed
                me (-1)^{\rk_2(J)} = (-1)^{\ord_2\left(\prod_v \frac {c_v(J)}{c(J')} \frac{\Omega _J}{\Omega _{J'}}      \right)}

            p
                | Missed ????????
                // TODO

            p
                | Take #[m a \in \Sha(A/K)] then #[m a] can be represented by a locally trivial PHS #[m X] over #[m K].
                | Let #[m K^\sep(X)]  be the function field of #[m X\otimes_K K^\sep].
                | Have an exact sequence
                me 0 \to (K^\sep)^\times \to (K^\sep(X))^\times \to K^\sep(X)^\times/(K^\sep)^\times \to 0
                | which yields
                me \Br(K)  = H^2(G_K, (K^\sep)^\times) \to H^2(G_K, K^\sep(X)^\times) \twoheadrightarrow H^2(G_K, K^\sep(X)^\times/(K^\sep)^\times) \to 0
                | the last 0 is as #[m H^3(G_K, (K^\sep)^\times) = 0]
                | as #[m X] is locally trivial (c.f. Mlne Arithmetic duality theory rmk. 6.11)
                | we have
                me 0 \to \prod_v\Br(K_v) \to \prod_v H^2(G_{K_v}, K^\sep(X)^\times) \to H^2(G_{K_v}, K^\sep(X)^\times/(K^\sep)^\times) \to \cdots

            p
                | On the other hand from the exact sequence
                me 0 \to K^\sep(X)^\times/(K^\sep)^\times \to \Div^0(X\otimes_K K^\sep) \to \Pic^0(X\otimes_K K^\sep) \to 0
                | we have
                me H^1(G_K, \Div^0(X\otimes_K K^\sep)) \to H^1(G_K, \Pic^0(X\otimes_K K^\sep)) \to H^2(G_k, K^\sep(X)^\times/(K^\sep)^\times) \to \cdots
                | now over #[m K^\sep], #[m A\otimes_K K^\sep \simeq X\otimes_K K^\sep]
                | hence
                me \Pic^0(X\otimes K^\sep) \simeq \Pic^0(A\otimes K^\sep)
                | hence one gets a map
                me H^1(G_K, \Pic^0(A\otimes K^\sep)) \to H^2(G_K, (K^\sep(X))^\times/(K^\sep)^\times)

            fact
                statement: p
                    | For Jacobians of curves if the principal polarization on #[m J] is given by a rational divisor then #[m \pair \cdot \cdot] is alternating, hence #[m |\Sha_0(A/K)| =  \square] otherwise #[m |\Sha_0(A/K)|  = 2 \square].
            p
                | Noted by Poonen and Stoll.

            theorem
                statement: p
                    | #[m C] is deficient at an odd number of place iff
                    me |\Sha_0(J)| =  2\square
                    |.

            definition#def-deficient-place
                title Deficient places
                statement: p
                    | We say that #[m C] is #[term deficient] at a place #[m v] if #[m C] doesn't have a #[m K_v] rational divisor of degree #[m g-1].
            p
                | Hence for genus #[m g] curves this says that #[m C] has no #[m K_v] rational divisor of degree #[m 1].
                | Equivalently #[m C] has no #[m K_v]-rational point over any odd degree extension of #[m K_v].

            p
                | E.g. if #[m K_v = \RR] we have #[m C] deficient iff #[m C(\RR) \ne \emptyset].
                me y^2 = cq_1(x) q_2(x) q_3(x),\,c\gt 0\text{ and }q_i\text{ irred over }\RR
            figure
                caption/
                image: latex-image.
                    \begin{tikzpicture}
                      \begin{axis}[hide axis]
                        \addplot +[no markers,
                          raw gnuplot,
                          thick,
                          empty line = jump, % not strictly necessary, as this is the default behaviour in the development version of PGFPlots
                          id = g2notdef,
                          ] gnuplot {
                          set contour base;
                          set cntrparam levels discrete 0.003;
                          unset surface;
                          set view map;
                          set samples 700;
                          set isosamples 700;
                          splot y^2 - (x^2 + 1)*(x^2 + 3)*(x^2 + 5);
                        };
                      \end{axis}
                    \end{tikzpicture}

            p
                | Here #[m c \gt 0] and #[m C(\RR) \ne \emptyset] and #[m C] is not deficient over #[m \RR].
            p
                | Alternatively  #[m c \lt 0] and #[m C(\RR) = \emptyset] and #[m C] is deficient over #[m \RR].

        paragraphs
            title Infinite places

            definition
                statement: p
                    | Let #[m J/K] be a jacobian admitting a Richelot isogeny #[m \phi ] over #[m K] for a place of #[m K] such that #[m v |  \infty ], we denote #[m \phi _v] the map induced by #[m \phi ] on #[m J(K_v)] and define
                    me \varphi  \colon J(K_v)^0 \to J(K_v)^0
                    | the restriction of #[m \phi _v] to the identity component.

            lemma
                statement: p
                    me \frac{\Omega _J}{\Omega _{J'}} = \prod_{v| \infty } \frac { n(J'(K_v))}{|\ker (\varphi) | n(J(K_v))}
                    | where #[m n (J(K_v))] denotes the number of connected components of #[m J(K_v)].

                proof
                    p
                        | Same as the elliptic curve case.


            p
                | Case #[m K_v = \CC] here #[m n(J(\CC)) = 1 = n(J'(\CC))] and #[m |\ker \varphi | = 4]

            proposition
                statement: p
                    me.
                        n(J(\RR)) =
                        \begin{cases}
                        2^{n(C(\RR)) - 1} \amp\text{ if }n(C(\RR)) \gt 0\text, \\
                        1 \amp\text{ if }n(C(\RR)) = 0\text.
                        \end{cases}
            proposition
                statement: p
                    | A divisor  #[m D_i = \lb P_i, Q_i \rb \in \ker (\phi )] is in #[m \ker \varphi ] iff the points #[m P_i, Q_i] satisfy either
                    ol
                        li
                            | #[m P_i  =  \overline Q_i], or
                        li
                            | #[m P_i] and #[m Q_i] lie on  the same connected component of #[m C(\RR)].


            figure
                caption/
                image: latex-image.
                    \begin{tikzpicture}
                      \begin{axis}[hide axis]
                        \addplot +[no markers,
                          raw gnuplot,
                          thick,
                          empty line = jump, % not strictly necessary, as this is the default behaviour in the development version of PGFPlots
                          id = g2realcomp1,
                          ] gnuplot {
                          set contour base;
                          set cntrparam levels discrete 0.002;
                          unset surface;
                          set view map;
                          set samples 900;
                          set isosamples 900;
                          splot y^2 - (x^2 - 1)*(x^2 - 3)*(x^2 - 5);
                        };
                      \end{axis}
                    \end{tikzpicture}

            figure
                caption/
                image: latex-image.
                    \begin{tikzpicture}
                        \begin{axis}[hide axis]
                        \addplot +[no markers,
                          raw gnuplot,
                          thick,
                          empty line = jump, % not strictly necessary, as this is the default behaviour in the development version of PGFPlots
                          id = g2realcomp2,
                          ] gnuplot {
                          set contour base;
                          set cntrparam levels discrete 0.002;
                          unset surface;
                          unset border;
                          unset xtics;
                          unset ytics;
                          set view map;
                          set samples 900;
                          set isosamples 900;
                          splot y^2 + (x^2 - 1)*(x^2 - 3)*(x^2 - 5);
                        };
                      \end{axis}
                    \end{tikzpicture}

            p
                | #[m D_1=  \lb (r_1, 0), (r_2,0)\rb] with #[m r_1,r_2] the smallest roots.
                | Then #[m D_1\in \ker \varphi].

            p
                | #[m D_2=  \lb  (r_1, 0), (r_3,0) \rb ] with #[m r_3] the next smallest root.
                | Then #[m D_2\not\in \ker \varphi].

        aside: p Lecture ? 23/4/2018

        p
            | Missed
        proposition
            statement: p

                | The number of real roots of #[m F(x)] (hence #[m n( J(K_v))]) is given as follows (addition modulo 3):
                ol
                    li
                        | If #[m \delta _i\in \RR ] and #[m \delta _{i+1} , \delta _{i+2} \not\in \RR], i.e. #[m \delta _{i+1} = \overline \delta _{i+2}] then
                        me \delta _i' \in \RR,\,\delta _{i+1}', \delta _{i+2}' \not \in \RR
                        | with
                        me \delta _{i+1}' = \overline \delta _{i+2}'
                        | .
                    li
                        | If #[m \delta _i, \delta _{i+1}\in \RR ] then #[m \delta _{i+2}'\in \RR], and #[m \delta _{i+2}' \lt 0] iff #[m k_{i, i+1} \lt 0].
            proof
                p
                    | Clear since
                    me \delta _i' = \frac {4}{\Delta _G^2} (\alpha _{i+1} - \alpha _{i+2})(\alpha _{i+1} - \beta  _{i+2})(\beta  _{i+1} - \alpha _{i+2})(\beta  _{i+1} -\beta_{i+2})
                    | for #[m i = 1,2,3].

        remark
            p
                | #[m m_G'] follows from the signs of #[m \delta _1', \delta _2', \delta _3'] and the leading term of #[m F(x)].

        example
            statement: p
                | Let #[m G_1(x) = x^2 - 16, G_2(x) + x^2 + x + \frac{17}4, G_3 = x^2 - 2x  + 9].
                | We have #[m \delta _1=64, \delta _2 = -16, \delta _3 = -32].
                | #[m C] has one real connected component hence #[m n(J(\RR)) = 1] and #[m m_v = 1].

        p
            | Now
            me D_1 = \lb (\alpha _1,0), (\beta _1, 0)\rb \in \ker \phi
            me D_2 = \lb (\alpha _2,0), (\overline \alpha_2, 0)\rb
            me D_3 = \lb (\alpha _3,0), (\overline \alpha_3, 0)\rb \in \ker \phi
            | so #[m |\ker \phi | = 4].
        p
            | Also #[m \delta _{1}' ,\delta _{2}', \delta _{3}'\in \RR] all #[m k_{i,j} \gt 0] so #[m \delta _{1}' ,\delta _{2}', \delta _{3}'\gt 0] so that #[m C'] has #[m 3] connected components and #[m n(J'(\RR)) = 4] and #[m m_v' = 1].


        paragraphs
            title Tamagawa numbers (#[m v \nmid \infty ])
            p
                | We need to compute #[m \frac{c_v(J)}{c_v(J')}] (we won't at #[m v | 2]).
            p
                | Recall that for an abelian variety #[m A/K] over a number field
                me c_v(A) = |A(K_v)/A_0(K_v)|

            lemma
                statement: p
                    | Let #[m S] be a finite set of primes of #[m K] containing archimidean places and bad reduction places.
                    | For each place #[m v\not\in S], denote #[m \widetilde A_v] the abelian variety over the residue field #[m \FF_{q_v}] where #[m q_v = N_{{K_v}/\QQ_v} (v)].
                    | Set #[m d = \dim A = \dim \widetilde A_{v}].
                    | Let #[m \omega  \ne 0 ] be a choice of exterior differential form of degree #[m d] on #[m A] defined over #[m K] and for #[m v\nmid \infty ].
                    | Consider #[m |\omega |_v \mu _v^d] which determines a Haar measure on #[m A(K_v)].
                    | Then
                    me \int_{A(K_v)} | \omega |_v \mu _v^d = \left | \frac{\omega }{\omega _0} \right | c_v | \widetilde A_v(\FF_{q_v})| q^{-d}
                    | where #[m \omega _0] is  a choice of #[m v]-regular #[m d]-form with #[m (\widetilde \omega _0)_v \ne 0] and if #[m A] had bad reduction at #[m v] then #[m \widetilde A_v (\FF_{q_v})|] is the  number of #[m \FF_{q_v}] points on the special fibre #[m \widetilde A_v] of Neron's minimal model.

                proof
                    title Sketch of proof
                    p
                        me \int_{A(K_v)} | \omega |_v \mu _v^d = \left | \frac{\omega }{\omega _0} \right |  \int_{A(K_v)} | \omega_0 |_v \mu _v^d
                        me                                     = \left | \frac{\omega }{\omega _0} \right | \left| A(K_v)/A_0(K_v)\right| \int_{A_0(K_v)} | \omega_0 |_v \mu _v^d
                        me                                     = \left | \frac{\omega }{\omega _0} \right | c_v \left| A_0(K_v)/A_1(K_v)\right| \int_{A_1(K_v)} | \omega_0 |_v \mu _v^d
                        me                                     = \left | \frac{\omega }{\omega _0} \right | c_v \left| \widetilde A_v(\FF_{q_v})\right| q_v^{-d}
                        |.

            p
                | How to compute #[m c_v]? Need to compute #[m |\widetilde A_v(\FF_{q_v})|].
            example
                statement: p
                    | Consider an elliptic curve #[m E].

                    | Recall that by Hensel's lemma, #[m E_0(K_v) \twoheadrightarrow \widetilde E_{ns}(\FF_{q_v})]
                    | let
                    me f(x,y) = y^2 + a_1 xy + a_3y - x^3 - a_2 x^2 - a_4 x - a_6 = 0
                    | be the minimal Weierstraß equation for #[m E].
                    | Let #[m \tilde f(x,y) ] be the reduced polynomial mod #[m \pi _v].
                    | and #[m \tilde P(\tilde \alpha , \tilde \beta ) \in \widetilde E_{ns}(\FF_{q_v})] a point.
                    | Since #[m P] is non-singular either
                    me \partder[\tilde f]{x}(\tilde P) \ne 0 \text{ or } \partder[\tilde f]{y}(\tilde P) \ne 0
                    | say the latter, then choose any #[m x_0 \in \ints_{K_v}] with #[m x_0 \equiv \tilde \alpha \pmod{\pi _v}] then #[m f(x_0, y) = 0] has #[m \tilde f(x_0, \tilde \beta ) = 0] as #[m \beta ] is a simple root.
                    | By Hensel's lemma there exists #[m y_0 \in \ints_{K_v}] such that #[m \tilde y_0 = 0] and #[m f(x_0,y_0) = 0].
                    | So #[m P=(x_0, y_0) \in E_0(K)] reduces to #[m \widetilde P].
            p
                | For non-singular points get points over #[m \ints_{K_v}].

            example
                statement: p
                    me E \colon y^2 = (x+1)(x-p^2)(x+p^2), \,p\gt 3
                    me \widetilde E \colon \widetilde y^2 = (\widetilde x+1)\widetilde x^2
        aside: p Lecture ? 25/4/2018

        p
            | Missed more sorry

        remark
            p
                | We are interested in #[q good] models, i.e. we require that
                me \mathcal E (\ZZ)_p = E(\QQ_ p)
                | .
        p
            | Our model #[m \mathcal E /\ZZ\colon  y^2=(x+1)(x-p^2)(x+p^2)] is proper since #[m \mathcal E \subseteq \PP^2_{\ZZ_p}] so that #[m \mathcal E (\ZZ_p) = E(\QQ_p)] but it is singular since its special fibre is.

        p
            | We need to manipulate #[m \mathcal E/\ZZ_p \colon  y^2 = (x+1)(x-p^2)(x+p^2)] s.t.
            ol
                li
                    | #[m \mathcal E] is a model of #[m \ZZ_p].
                li
                    | The generic fibre is #[m E/\QQ_p]
                li
                    | Only non-singular points of its special fibre can be lifted to points over #[m \QQ_p] on #[m E]


        p
            | To satisfy 1 and 2, we can do change of variables of the form
            me x=  x_1p,\,y=y_1p,\,x=x_1y,\, p=p_1y,\,y= y_1x, p=p_1x
            | .

        p
            | We will use only #[m y=y_1p] for now.

        p
            me \mathcal C_1 \colon y^2  = (x+p^2)(x-p^2) (x + 1)
            me \widetilde{\mathcal C}_1\colon \tilde y^2  = \tilde x^2 (\tilde x + 1) \simeq \PP^1
        figure
            caption/
            image: latex-image.
                \begin{tikzpicture}
                    \begin{axis}[hide axis]
                    \addplot +[no markers,
                      raw gnuplot,
                      thick,
                      empty line = jump, % not strictly necessary, as this is the default behaviour in the development version of PGFPlots
                      id = g1node,
                      ] gnuplot {
                      set contour base;
                      set cntrparam levels discrete 0.002;
                      unset surface;
                      unset border;
                      unset xtics;
                      unset ytics;
                      set view map;
                      set samples 900;
                      set isosamples 900;
                      splot y^2 - x^2*(x + 1);
                    };
                  \end{axis}
                \end{tikzpicture}

        p
            me \mathcal C_{2,3} \colon y_1^2  = (x_1+p)(x_1-p) (px_1 + 1),\,x=x_1p,\,y=y_1p
            me \widetilde{ \mathcal C}_{2,3} \colon \tilde y_1^2  = \tilde x_1^2 \simeq \PP^1 \cup \PP^1 \eqqcolon \Gamma _2 \cup \Gamma _3
        p
            me \mathcal C_{4} \colon y_2^2  = (x_2+1)(x_2-1) (p^2x_2 + 1),\,x_1=x_2p,\,y_1=y_2p
            me \widetilde {\mathcal C}_{4} \colon \tilde y_2^2  = (\tilde x_2 - 1)(\tilde x_2  + 1)
        p
            | The collection of these charts (together with their counterpart at infinity) give a regular model #[m \mathcal E] of #[m E/\QQ_p].

        p
            | So we have four components, all #[m \PP^1] meeting in a square.
            | (There are still singularities on #[m \mathcal E] at intersection points in the special fibre, but they are regular singularities, i.e. the local ring at these points is regular, i.e. we have #[m \ideal m_P/ \ideal m_P^2] dimension 2).

        example
            statement: p
                | Let #[m a\in \ZZ_p], #[m E \colon y^2 = x^3 + a].
                | #[m E] might be singular at #[m P = (0,0)], if #[m a\equiv  0\pmod p] then we degenerate to a cusp.
                | The maximal ideal #[m \ideal m_P] of the local ring is generated by #[m x,y,p].
                | If #[m a\not \equiv 0 \pmod {p^2}] then #[m v(a) = 1] and #[m p \in a\ZZ_p].
                | But #[m a = y^2 - x^3] so, #[m p \in (y^2 - x^3)\ZZ_p \subseteq \ideal m_P^2].
                | So #[m x,y] generate #[m \ideal m_P/\ideal m_P^2] and #[m P] is regular.
                | If #[m a \equiv 0 \pmod{p^2}] then #[m \ideal m_P/\ideal m_P^2] cannot be generated by fewer than 3-elements so #[m P] is not regular.


        proposition
            statement: p
                | Let #[m \mathcal C /\ZZ_p] be an arithmetic surface and #[m C/\QQ_p] be the generic fibre of #[m \mathcal C].
                ol
                    li
                        | If #[m \mathcal C] is proper then #[m C(\QQ_p) = \mathcal C(\ZZ_p)].
                    li
                        | If #[m \mathcal C] is regular and proper then
                        me C(\QQ_p) = \mathcal C(\ZZ_p)  =\mathcal C^0(\ZZ_p)
                | where #[m \mathcal C^0 \subseteq \mathcal C = \mathcal C \smallsetminus] singular points.

        remark
            p
                | The smooth part of a proper regular arithmetic surface is large enough to contain all of the rational points on the generic fibre.

        definition#def-neron-model
            title Neron models
            statement: p
                | The #[term Neron model] of #[m E/K] is an arithmetic surface #[m \mathcal E/K] whose generic fibre is the given elliptic curve.
                | It is such that every point of #[m E] gives a point of #[m \mathcal E] and such that the group law on #[m E] extends to make #[m \mathcal E] into a group (as a scheme over #[m R]).

        remark
            p
                | Neron models are smooth #[m R]-schemes i.e. for every point #[m p\in \Spec (R)] the fibre is a non-singular variety. However it might have several components and may not be complete. So in general #[m \mathcal E] will not be proper over #[m R].
                me \mathcal E/\ZZ_p \colon  y^2 = (x-1)(x-2)(x-3),\,p\gt 3

        theorem
            statement: p
                | Let #[m E/K] be an elliptic curve, #[m \mathcal C/R] a proper minimal regular model for #[m E/K] and let #[m \mathcal E/R] be the largest subscheme pf #[m \mathcal C/R] which is smooth over #[m R].
                | Then #[m \mathcal E/R] is a Neron model for #[m E/K].

        aside: p Lecture ? 30/4/2018

        p
            | Recall we need to compute #[m |E(\QQ_p)/E_0(\QQ_p)|] and we considered the example
            me E/\QQ_p\colon  y^2 = x(x-p^2)(x+p^2)
            |.

        p
            me \overline{ \mathcal C}_{1} \colon \tilde y^2  = \tilde x + 1 \eqqcolon \Gamma _2 \cup \Gamma _1
            me \overline{ \mathcal C}_{2,3} \colon \tilde y_1^2  = \tilde x_1^2 \simeq \PP^1 \cup \PP^1 \eqqcolon \Gamma _2 \cup \Gamma _3
        p
            me \overline {\mathcal C}_{4} \colon \tilde y_2^2  = (\tilde x_2 - 1)(\tilde x_2  + 1)

        p
            | Write #[m \mathcal E^0] for #[m \mathcal E \smallsetminus \{\text{singularities in special fibre}\}] then
            me \mathcal E(\ZZ_p) = \mathcal E^0(\ZZ_p) = E(\QQ_p)
            | .
        p
            | We saw that the Neron model of #[m E/\QQ_p] can be obtained from #[m \mathcal E/\ZZ_p] be removing the singularities in the special fibres.

        proposition
            statement: p
                me E(\QQ_p) / E_0(\QQ_p) \simeq \mathcal E(\ZZ_p)/\mathcal E^0(\ZZ_p) \hookrightarrow \left(\overline {\mathcal E}(\overline \FF_p)\middle/ \overline{\mathcal E}^0(\overline \FF_p)\right)^{\absgal {\FF_p}}
                | #[m \mathcal E] is the Neron model of #[m E/\QQ_p], and  #[m \mathcal E^0/\ZZ_p] denotes the identity component of #[m \mathcal E/\ZZ_p].
                | #[m \overline{\mathcal E} /\FF_p] denotes the special fibre of #[m \mathcal E].
                | #[m \overline{\mathcal E}^0/\FF_p] is the identity component of #[m \overline{\mathcal E}/\FF_p].

        p
            | In our case the Tamagawa number is
            me c_p = \left| \left(\overline {\mathcal E}(\overline \FF_p)\middle/ \overline{\mathcal E}^0(\overline {\FF_p})\right)^{\absgal {\FF_p}}\right| = 4

        p
            | To actually calculate this use Tate's algorithm.

    subsection
        title Jacobians of hyperelliptic curves

        p
            | Let #[m A/\QQ_p] be such a Jacobian.
            | #[m A] admits a Neron model #[m \mathcal A/\ZZ_p].
            | The open subscheme whose special fibre is the connected component of the identity #[m \widetilde {\mathcal A}^0].

        p
            | As for an elliptic curve write #[m A_0(\QQ_p)] for the points reducing to #[m \widetilde {\mathcal A}^0(\FF_p)], then
            me A(\QQ_p)/A_0(\QQ_p)
            | is finite and
            me  c_p(A/\QQ_p) = |A(\QQ_p)/A_0(\QQ_p)| = \left| \left(\widetilde {\mathcal A}(\overline \FF_p)\middle/ \widetilde{\mathcal A}^0(\overline {\FF}_p)\right)^{\absgal {\FF_p}}\right| = 4
            | .
        p
            | How to compute #[m c_p]?
        theorem
            statement
                p
                    | Let #[m C/\QQ_p] be a smooth proper, geometrically connected curve, let #[m \mathcal C/\ZZ_p] be the minimal regular model for #[m C], #[m J/\QQ_p] its jacobian, #[m \mathcal A/\ZZ_p] the Neron model for #[m J].
                p
                    | If #[m \mathcal J/\QQ_p] is semistable (ordinary double roots as singularities) then
                    me \widetilde{\mathcal A}^0/ {\FF}_p = \Pic^0(\overline {\mathcal C})
                    | as a consequence
                    me \left| \widetilde {\mathcal A}(\overline {\FF}_p)\middle/ \widetilde{\mathcal A}^0(\overline {\FF}_p)\right| = |\det M | \times \text{correction term}
                    | .
                    | Where #[m M] is any minor of the incidence matrix #[m N_{ij}] of
                    me \overline{\mathcal C}/ \overline{\FF}_p
                    | .
                    | #[m N_{ij}] is the size of the intersection of #[m \Gamma _i, \Gamma _j] for the irreducible components #[m \Gamma ] of #[m \overline{ \mathcal C}/\overline{\FF_p}].

        example
            statement: p
                me.
                    N_{ij} = \begin{pmatrix}
                    -2 \amp 1 \amp 0 \amp 1 \\
                    1 \amp -2 \amp 1 \amp 0 \\
                    0 \amp 1 \amp -2 \amp 1 \\
                    1 \amp 0 \amp 1 \amp -2 \\
                    \end{pmatrix}
                me.
                    M = \begin{pmatrix}
                    -2 \amp 1 \amp 0  \\
                    1 \amp -2 \amp 1  \\
                    0 \amp 1 \amp -2  \\
                    \end{pmatrix}
                me \det(M) = -4
                | . In order to compute #[m c_p] for #[m J] need to construct special fibre of minimal regular model for #[m C].

        p
            | Namikawa-Ueno classification of types of semistable reductions of genus 2 curves.

            ol
                li
                    | Good reduction: #[m g = 2]
                li
                    | One node.
                li
                    | Two nodes.
                li
                    | Three nodes.
                li
                    | One cusp (triple root).
                li
                    | Two cusps (triple root).

        paragraphs
            title Cassels-Tate pairing (Maria)

            claim
                statement: p
                    | #[m K] number field and #[m A/K] a.v. admits a principal polarization #[m \phi _D] given by a rational divisor.
                    | Then the Cassels-Tate pairing
                    me \pair \cdot \cdot_{\phi _D} \colon \Sha(A) \times \Sha(A) \to \QQ/\ZZ
                    | is alternating.
                proof
                    p
                        me \phi _D \colon A\to A^\vee \simeq \Pic^0(A)
                        | by sending #[m a\in A(K^\sep)], #[m \phi _D(a) = \lb D_a-  D\rb], where #[m D_a= D+a] is the translate of #[m D] by #[m a].

                    p
                        | Assume #[m D] is a rational divisor, what we'll prove is that #[m \pair a{\phi _D(a)} = 0] for all #[m a \in A].
                        | Where
                        me \pair \cdot \cdot \colon \Sha(A) \times \Sha(A^\vee) \to \QQ/\ZZ
                    p
                        | Fix #[m a \in \Sha(A,K) \subseteq H^1(G_K, A)] and let #[m X] be the corresponding PHS of #[m A].
                        | Then for any #[m P \in X(K^\sep)], #[m a] is represented by the cocycle
                        me \alpha (\sigma )\colon G_K \to A
                        me \sigma  \mapsto \sigma  (P) - P
                        |.
                    p
                        | Denote #[m a' = \phi _D(a)].
                        | Then  #[m a'] is represented by
                        me \alpha '(\sigma ) \colon G_K \to A^\vee = \Pic^0(A)
                        me \sigma \mapsto [D_{\alpha (\sigma )} - D]
                        | this lifts to
                        me \beta \colon  G_K\to \Div^0(A)
                        me \sigma \mapsto D_{\alpha (\sigma )} - D
                        | , which is a cocycle:
                        me \beta (\sigma \tau ) = \beta (\sigma ) + \sigma \beta (\tau )
                        me \beta (\sigma \tau ) = D_{\alpha (\sigma \tau ) } - D = D_{\alpha (\sigma ) + \sigma \alpha (\tau )} - D = D_{\alpha (\sigma )} - D = D_{\alpha (\sigma )} - D + D_{\sigma \alpha (\tau )} - D
                        me =  D_{\alpha (\sigma )} - D + \sigma (D_{\alpha (\tau )} - D) = \beta (\sigma  ) + \sigma (\beta (\tau ))
                        | using #[m K]-rationality of #[m D].

                    p
                        | Using
                        me A\otimes K^\sep \xrightarrow\sim X\otimes K^\sep
                        me Q\mapsto P + Q
                        | we can regard
                        me \alpha '\colon G_K \to \Pic^0(X)
                        me \beta  '\colon G_K \to \Div^0(X)
                        | now use
                        me H^1(G_K, \Div^0(X\otimes K^\sep)) \to H^1(G_K, \Pic^0(X\otimes K^\sep)) \to H^2(G_K, K^\sep(X)^\times/K^{\sep, \times})
                        me b = (\beta ) \mapsfrom a' = (\alpha ') \mapsto 0
                    p
                        | Big diagram to conclude.



    subsection
        title Semistable models of hyperelliptic curves of genus 2

        aside: p Lecture ? 1/5/2018

        p
            | Recall: Can compute Tamagawa numbers of semistable Jacobians of genus 2 curves from the special fibre of their minimal regular models (i.e. there exists a formula for them.
        definition
            statement: p
                | A model is semistable if its special fibre is geometrically reduced and has only ordinary double points as singularities.
                | When such a model exists over #[m K] we say that the curve is semistable over #[m K].
                | Or has semistable reduction #[m /K].


        example
            statement
                p
                    | #[m p \ge 7] and
                    me C\colon y^2  = (x-p^2)(x+p^2)(x-1)(x-2)(x-3)(x-4)
                    | a node
                figure
                    caption/
                    image: latex-image.
                        \begin{tikzpicture}
                            \begin{axis}[hide axis]
                            \addplot +[no markers,
                              raw gnuplot,
                              thick,
                              empty line = jump, % not strictly necessary, as this is the default behaviour in the development version of PGFPlots
                              id = g2node,
                              ] gnuplot {
                              set contour base;
                              set cntrparam levels discrete 0.002;
                              unset surface;
                              unset border;
                              unset xtics;
                              unset ytics;
                              set view map;
                              set samples 900;
                              set isosamples 900;
                              splot y^2 - x^2*(x - 1)*(x-2)*(x-3)*(x-4);
                            };
                          \end{axis}
                        \end{tikzpicture}
                p
                    | Have 1 genus 1 component meeting 3 genus 0 in a square on the special fibre of minimal regular model

        example
            statement
                p
                    | #[m p \ge 7] and
                    me C\colon y^2  = (x-p^2)(x+p^2)(x-1- p^2)(x-1+p^2)(x-3)(x-4)
                    | two nodes.
                figure
                    caption/
                    image: latex-image.
                        \begin{tikzpicture}
                            \begin{axis}[hide axis]
                            \addplot +[no markers,
                              raw gnuplot,
                              thick,
                              empty line = jump, % not strictly necessary, as this is the default behaviour in the development version of PGFPlots
                              id = g2twonode,
                              ] gnuplot {
                              set contour base;
                              set cntrparam levels discrete 0.002;
                              unset surface;
                              unset border;
                              unset xtics;
                              unset ytics;
                              set view map;
                              set samples 900;
                              set isosamples 900;
                              splot y^2 - x^2*(x - 1)^2*(x-3)*(x-4);
                            };
                          \end{axis}
                        \end{tikzpicture}
                p
                    | Have 7 genus 0 components meeting in a pair of squares with one common line.


        example
            statement
                p
                    | #[m p \ge 7] and
                    me C\colon y^2  = (x-p^2)(x+p^2)(x-1- p^2)(x-1+p^2)(x-2+p^2)(x-2-p^2)
                    | two nodes.
                figure
                    caption/
                    image: latex-image.
                        \begin{tikzpicture}
                            \begin{axis}[hide axis]
                            \addplot +[no markers,
                              raw gnuplot,
                              thick,
                              empty line = jump, % not strictly necessary, as this is the default behaviour in the development version of PGFPlots
                              id = g2threenode,
                              ] gnuplot {
                              set contour base;
                              set cntrparam levels discrete 0.002;
                              unset surface;
                              unset border;
                              unset xtics;
                              unset ytics;
                              set view map;
                              set samples 900;
                              set isosamples 900;
                              splot y^2 - x^2*(x - 1)^2*(x-3)^2;
                            };
                          \end{axis}
                        \end{tikzpicture}
                p
                    | Have 8 genus 0 components, two non-intersecting lines joined by 3 chains of two #[m \PP^1]s.

        example
            statement
                p
                    | #[m p \ge 7] and
                    me C\colon y^2  = (x-p^2)(x-2p^2)(x-3p^2)(x-4)(x-5)(x-6)
                    | a cusp.
                figure
                    caption/
                    image: latex-image.
                        \begin{tikzpicture}
                            \begin{axis}[hide axis]
                            \addplot +[no markers,
                              raw gnuplot,
                              thick,
                              empty line = jump, % not strictly necessary, as this is the default behaviour in the development version of PGFPlots
                              id = g2cusp,
                              ] gnuplot {
                              set contour base;
                              set cntrparam levels discrete 0.002;
                              unset surface;
                              unset border;
                              unset xtics;
                              unset ytics;
                              set view map;
                              set samples 900;
                              set isosamples 900;
                              splot y^2 - x^3*(x - 1)*(x-2)*(x-3);
                            };
                          \end{axis}
                        \end{tikzpicture}
                p
                    | Have 2 genus 1 components meeting.

        example
            statement
                p
                    | #[m p \ge 7] and
                    me C\colon y^2  = (x-p^2)(x-2p^2)(x-3p^2)(x-1-4p^2)(x-1-5p^2)(x-1-6p^2)
                    | two cusps.
                figure
                    caption/
                    image: latex-image.
                        \begin{tikzpicture}
                            \begin{axis}[hide axis]
                            \addplot +[no markers,
                              raw gnuplot,
                              thick,
                              empty line = jump, % not strictly necessary, as this is the default behaviour in the development version of PGFPlots
                              id = g2twocusp,
                              ] gnuplot {
                              set contour base;
                              set cntrparam levels discrete 0.002;
                              unset surface;
                              unset border;
                              unset xtics;
                              unset ytics;
                              set view map;
                              set samples 900;
                              set isosamples 900;
                              splot y^2 - x^3*(x - 1)^3;
                            };
                          \end{axis}
                        \end{tikzpicture}
                p
                    | Have 2 genus 1 components  joined by a #[m \PP^1].

        paragraphs
            title Places of #[m K] above #[m 2]
            p
                | Here it is very difficult to compute a minimal regular model for #[m C], hence can't compute the Tamagawa numbers.

            p
                | One way around  is to use the definition of the local contribution
                me (-1)^{\ord_2 \left| \frac{\coker \phi_v}{\ker \phi_v}\right|}
                |.
            proposition
                statement: p
                    | Consider the family
                    me \mathcal F\colon y^2 = (x^2 - (4t_1)^2)(x^2 + t_2 x + t_3)(x^2 + t_4 x + t_5)
                    | such that #[m t_i \in \ints_K], #[m t_2 \equiv  1 \pmod 2], #[m t_3 - \frac 14 \equiv 0 \pmod 2], #[m t_4 \equiv  - 2 \pmod 8], #[m t_5 \equiv 1 \pmod 8].
                    | Then #[m C \in \mathcal F] has totally split toric reduction, and assuming that #[m G_2(x),G_3(x)] are both irreducible over #[m K_v] then
                    me (-1)^{\ord_2 \left| \frac{\coker \phi_v}{\ker \phi_v}\right|}   =1
                    | .

            p
                | So combining #[m v | \infty ], #[m v\nmid 2\infty ], #[m v | 2] if #[m C \in \mathcal F] over #[m K_v] for #[m v| 2] and semistable at #[m v \nmid 2\infty ] with #[m C] a Richelot curve then we can compute the parity of the #[m \rk_2(J)].

            example
                statement: p
                    me C \colon  y^2 =(x^2 - 16)(x^2 + x + \frac{17}{4} ) (x^2 -2x  + 9)
                    me C/\RR \implies (-1)^{\ord_2|n(J) m_\RR / n(J')/ m'_\RR |\ker \phi |  | }= (-1)^{\ord_2(1\cdot 1 / 4 \cdot 4  \cdot 1)} = 1
                    | have #[m C/\QQ_p] for #[m p = 3,5,11,13, 17, 97, 1201] and #[m p = 131] is good reduction for #[m C] but not for #[m C'].
                    | For #[m  p =3,17] have #[m c_p=2, m_p=1].
                    | For #[m  p =5, 11, 13, 97, 1201] have similar with non-split nodes.
                    | #[m p =131] have #[m c_p = 1,m_p = 1], #[m c'_p = 1, m'_p =2]. Two e.c.s swapped.
                    me (-1)^{\ord_2\left( \frac {c_p}{c'_p} \frac{m_p}{m'_p}\right)} =  -1
                    | for #[m   p = 2]
                    me (-1)^{\ord_2\left( \frac {\coker(\phi _2)}{\ker \phi _2}\right)} =  1
                    | hence
                    me (-1)^{\rk_2(J)} = \prod_v (-1)^{\ord_2\left( \frac {\coker(\phi _v)}{\ker \phi _v}\right)} =  1
                    | so #[m J] has even #[m \rk_2(J)].

